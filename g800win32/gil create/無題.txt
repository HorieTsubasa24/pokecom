matk_action_gil:
 ld HL,gil_matk_count
 ld E,(HL)
 inc E
 dec E
 ret z
 dec E
 ld (HL),E

 ld HL,gil_xy
matk_action:;HL=obj address+
 ex AF,AF'
 ld (matk_action_gil_ret+1),A
 ld (matk_action_HLP+1),HL
 call wall_ck
 jp c,matk_action_gil_ret
 jp z,matk_action_gil_ret
block_pointaP:
 ld HL,overwrite		;block address
 ld C,(HL)
 inc C
 jp z,gil_matk_break 
 ld (HL),0
 
; call bls

matk_action_HLP:
 ld HL,overwrite
 ld (matk_action_gil_ret+3),HL

 ld E,(HL)
 inc HL
 ld D,(HL)
 ld A,D
 and 11000000b
 jr z,matk_action_u
 cp 80h
 jr c,matk_action_r
 jr z,matk_action_d
matk_action_l:
 dec E
 call grp_del
 jr matk_action_gil_ret
matk_action_d:
 inc D
 call grp_del
 jr matk_action_gil_ret
matk_action_r:
 inc E
 call grp_del
 jr matk_action_gil_ret
matk_action_u:
 dec D
 call grp_del
 jr matk_action_gil_ret

gil_matk_break:
 xor A
 ld (gil_matk_count),A
matk_action_gil_ret:
 ld A,overwrite
 ld HL,overwrite
 ex AF,AF'
 ret