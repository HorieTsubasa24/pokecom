			  Z80 ASSEMBLER - ZASM VER 1.6
  0100                	org 0100h
                      	
  0000                	overwrite:equ 0
  001E                	x0:equ 30
  008C                	xm:equ 140
  0000                	y0:equ 0
  002F                	ym:equ 47
  0080                	t:equ 80h
  0000                	f:equ 0
                      	
  BFD0                	grp:equ 0bfd0h
  BFF1                	msp:equ 0bff1h
  BCFD                	kwait:equ 0bcfdh
  BE53                	kscan:equ 0be53h
                      	
                      	
                      	
                      	;*******************Title graph********************
  0100                	start:
  0100  210000        	 ld HL,0
  0103  39            	 add HL,SP
  0104  22FD09        	 ld (retP+1),HL
  0107  CD8B0A        	 call cls 
  010A  212B14        	 ld HL,graph_title
  010D  110800        	 ld DE,0008h
  0110  0632          	 ld B,50
  0112  CDD60A        	 call grp_open
  0115                	start_l:
  0115  3E01          	 ld A,1
  0117  32D845        	 ld (floor),A
  011A  CDE50A        	 call keysc		;left,right,on,0,/,space,down,up
  011D  CB57          	 bit 2,A
  011F  C0            	 ret nz
  0120  CB5F          	 bit 3,A
  0122  2006          	 jr nz,before_game_c
  0124  CB6F          	 bit 5,A
  0126  2052          	 jr nz,Stating_before
  0128  18EB          	 jr start_l
                      	;*****************Continue*******************
  012A                	before_game_c:
  012A  CB6F          	 bit 5,A
  012C  28E7          	 jr z,start_l
  012E  CD8B0A        	 call cls
  0131  214903        	 ld HL,continue_ms
  0134  110201        	 ld DE,0102h
  0137  0612          	 ld B,18
  0139  CDF1BF        	 call msp
  013C  2AD845        	 ld HL,(floor)
  013F  2600          	 ld H,0
  0141  CD450A        	 call ascn
  0144                	before_game_c_floor:
  0144  2AD845        	 ld HL,(floor)
  0147  2600          	 ld H,0
  0149  CD450A        	 call ascn
  014C  21430A        	 ld HL,nmemry+3
  014F  110B03        	 ld DE,030bh
  0152  0602          	 ld B,2
  0154  CDF1BF        	 call msp
  0157  CDFDBC        	 call kwait
  015A  21D845        	 ld HL,floor
  015D  FE1E          	 cp 1eh
  015F  2819          	 jr z,Stating_before
  0161  FE20          	 cp 20h
  0163  280C          	 jr z,before_game_c_u
  0165  FE1F          	 cp 1fh
  0167  20DB          	 jr nz,before_game_c_floor
  0169                	before_game_c_d:
  0169  35            	 dec (HL)
  016A  AF            	 xor A
  016B  BE            	 cp (HL)
  016C  20D6          	 jr nz,before_game_c_floor
  016E  34            	 inc (HL)
  016F  18D3          	 jr before_game_c_floor
  0171                	before_game_c_u:
  0171  34            	 inc (HL)
  0172  3E3D          	 ld A,61
  0174  BE            	 cp (HL)
  0175  20CD          	 jr nz,before_game_c_floor
  0177  35            	 dec (HL)
  0178  18CA          	 jr before_game_c_floor
                      	;***************Starting game****************
                      	;***************massage*********************
  017A                	Stating_before:
  017A  CD8B0A        	 call cls
  017D  213103        	 ld HL,stating_ms1
  0180  110801        	 ld DE,0108h
  0183  0609          	 ld B,9
  0185  CDF1BF        	 call msp
  0188  213A03        	 ld HL,stating_ms2
  018B  110802        	 ld De,0208h
  018E  060A          	 ld B,10
  0190  CDF1BF        	 call msp
  0193  214403        	 ld HL,stating_msf
  0196  110804        	 ld De,0408h
  0199  0605          	 ld B,5
  019B  CDF1BF        	 call msp
  019E  2AD845        	 ld HL,(floor)
  01A1  2600          	 ld H,0
  01A3  CD450A        	 call ascn
  01A6  21430A        	 ld HL,nmemry+3
  01A9  110E04        	 ld DE,040eh
  01AC  0602          	 ld B,2
  01AE  CDF1BF        	 call msp
  01B1  CD080A        	 call tim255
  01B4  CDFDBC        	 call kwait
                      	
                      	;***********************map set************************
  01B7  CD130D        	 call Map_make
                      	
                      	
                      	;**********************left right wall***********************
  01BA  0E02          	 ld c,2
  01BC  3E1B          	 ld A,27
  01BE  32C601        	 ld (Stating_before_mkwall1+1),A
  01C1                	Stating_before_mkwall2
  01C1  1600          	 ld D,0
  01C3  0606          	 ld B,6
  01C5                	Stating_before_mkwall1:
  01C5  1E00          	 ld E,overwrite
  01C7  C5            	 push BC
  01C8  D5            	 push DE
  01C9  215B03        	 ld HL,wall_grp
  01CC  0603          	 ld B,3
  01CE  CDB00E        	 call grp_set+2
  01D1  D1            	 pop DE
  01D2  C1            	 pop BC
  01D3  3E08          	 ld A,8
  01D5  82            	 add A,D
  01D6  57            	 ld D,A
  01D7  10EC          	 djnz Stating_before_mkwall1
  01D9  3E8D          	 ld A,141
  01DB  32C601        	 ld (Stating_before_mkwall1+1),A
  01DE  0D            	 dec C
  01DF  20E0          	 jr nz,Stating_before_mkwall2
                      	
                      	;**************************wall dot set***********************
                      	
  01E1  0E0F          	 ld c,15
  01E3  3E24          	 ld A,36
  01E5  32ED01        	 ld (Stating_before_mkwall11+1),A
  01E8                	Stating_before_mkwall21
  01E8  1606          	 ld D,6
  01EA  0606          	 ld B,6
  01EC                	Stating_before_mkwall11:
  01EC  1E00          	 ld E,overwrite
  01EE  C5            	 push BC
  01EF  D5            	 push DE
  01F0  215E03        	 ld HL,pole_grp
  01F3  0601          	 ld B,1
  01F5  CDB00E        	 call grp_set+2
  01F8  D1            	 pop DE
  01F9  C1            	 pop BC
  01FA  3E07          	 ld A,7
  01FC  82            	 add A,D
  01FD  57            	 ld D,A
  01FE  10EC          	 djnz Stating_before_mkwall11
  0200  3AED01        	 ld A,(Stating_before_mkwall11+1)
  0203  C607          	 add A,7
  0205  32ED01        	 ld (Stating_before_mkwall11+1),A
  0208  0D            	 dec C
  0209  20DD          	 jr nz,Stating_before_mkwall21
                      	
                      	
                      	;********************************obj set***************************
                      	
                      	;***********************init************************
  020B                	stating_obj:
  020B  21DF45        	 ld HL,obj
  020E  3600          	 ld (HL),0
  0210  11E045        	 ld DE,obj+1
  0213  012001        	 ld BC,48+48+48+96+48
  0216  EDB0          	 ldir
                      	;***********************obj countor**************
  0218  217716        	 ld HL,obj_1
  021B  3AD845        	 ld A,(floor)
  021E  3D            	 dec A
  021F  280B          	 jr Z,stating_obj_1
                      	
  0221  57            	 ld D,A
                      	;*********************0=end sign****next floor data***ldi loop**********
  0222                	stating_obj_2:
  0222  010000        	 ld BC,0
  0225  3E00          	 ld A,0
  0227  EDB1          	 cpir
  0229  15            	 dec D
  022A  20F6          	 jr nz,stating_obj_2
  022C                	stating_obj_1:
  022C  11DF45        	 ld DE,obj
  022F                	stating_obj_3:
  022F  7E            	 ld A,(HL)
  0230  B7            	 or A
  0231  2804          	 jr z,stating_obj_7
  0233  EDA0          	 ldi
  0235  18F8          	 jr stating_obj_3
                      	
                      	;*********************obj cp= then goto mainbefore***************
                      	
  0237                	stating_obj_7:
  0237  21DF45        	 ld HL,obj
  023A  110000        	 ld DE,0
  023D                	stating_obj_4:
  023D  AF            	 xor A
  023E  BE            	 cp (HL)
  023F  CABF02        	 jp z,main_before		;stating_obj_hp
  0242  E5            	 push HL
  0243  D5            	 push DE
                      	
                      	;x=x+7*A
  0244  ED5F          	 ld A,R;call rand
  0246  E60F          	 and 0fh		;a=0~15
  0248  211E00        	 ld HL,001eh	;30
  024B  110700        	 ld DE,0007h
  024E  CD390A        	 call xsan
                      	
                      	
                      	;y=y+7*A
  0251  CD180A        	 call rand
  0254                	stating_obj_5:
  0254  D606          	 sub 6
  0256  30FC          	 jr nc,stating_obj_5
  0258  C606          	 add A,6
  025A  110007        	 ld DE,0700h
  025D  CD390A        	 call xsan
                      	
  0260  D1            	 pop DE
  0261  E5            	 push HL		;xy
                      	
  0262  219F46        	 ld HL,obj_xy		;address
  0265  19            	 add HL,DE		;address+
                      	
  0266  CD7902        	 call stating_obj_hp_wp
                      	
  0269  19            	 add HL,DE		;address++
  026A  227002        	 ld (stating_obj_6+1),HL
                      	; add HL,DE		;address++(direction)
  026D  13            	 inc DE
                      	
  026E  E1            	 pop HL
                      	
                      	; ld HL,151eh;(30,0)
                      	
  026F                	stating_obj_6:
  026F  220000        	 ld (overwrite),HL
  0272  226C47        	 ld (gil_xy),HL
  0275  E1            	 pop  HL
  0276  23            	 inc HL
  0277  18C4          	 jr stating_obj_4
                      	
                      	;*********************obs  hp  wp set*********************
  0279                	stating_obj_hp_wp:
  0279  E5            	 push HL
  027A  D5            	 push DE
  027B  21AA02        	 ld HL,stating_obj_hp_wp6
  027E  E5            	 push HL
                      	
  027F  21DF45        	 ld HL,obj
  0282  19            	 add HL,DE
  0283  7E            	 ld A,(HL)
  0284  E60F          	 and 0fh
  0286  CB7E          	 bit 7,(HL)
  0288  201C          	 jr nz,stating_obj_hp_wp5
  028A  CB76          	 bit 6,(HL)
  028C  2014          	 jr nz,stating_obj_hp_wp4
  028E  CB6E          	 bit 5,(HL)
  0290  200C          	 jr nz,stating_obj_hp_wp3
  0292  CB66          	 bit 4,(HL)
  0294  2004          	 jr nz,stating_obj_hp_wp2
  0296                	stating_obj_hp_wp1:
  0296  21A345        	 ld HL,hp_table1
  0299  C9            	 ret
  029A                	stating_obj_hp_wp2:
  029A  21B345        	 ld HL,hp_table2
  029D  C9            	 ret
  029E                	stating_obj_hp_wp3:
  029E  21BC45        	 ld HL,hp_table3
  02A1  C9            	 ret
  02A2                	stating_obj_hp_wp4:
  02A2  21C345        	 ld HL,hp_table4
  02A5  C9            	 ret
  02A6                	stating_obj_hp_wp5:
  02A6  21C845        	 ld HL,hp_table5
  02A9  C9            	 ret
  02AA                	stating_obj_hp_wp6:
  02AA  5F            	 ld E,A
  02AB  1D            	 dec E
  02AC  1600          	 ld D,0
  02AE  19            	 add HL,DE
  02AF  7E            	 ld A,(HL)
  02B0  D1            	 pop DE
  02B1  210F46        	 ld HL,obj_hp
  02B4  19            	 add HL,DE
  02B5  77            	 ld (HL),A
  02B6  E1            	 pop HL
  02B7  E67F          	 and 01111111b
                      	 ;********************************************************HP*******************************
  02B9  3E38          	 ld A,00111000b
  02BB  326047        	 ld (gil_hp),A
  02BE  C9            	 ret	;gil is end of data.
                      	
                      	
                      	
                      	;wall
                      	
                      	;****************before farse***pgil_xy set**************
                      	
  02BF                	main_before:
  02BF  2A6C47        	 ld HL,(gil_xy)
  02C2  22DD45        	 ld (pgil_xy),HL 
  02C5  217716        	 ld HL,obj_1
  02C8  3AD845        	 ld A,(floor)
  02CB  3D            	 dec A
  02CC  2810          	 jr z,main_before_15
  02CE  57            	 ld D,A
  02CF  AF            	 xor A
  02D0  010000        	 ld BC,0
  02D3                	main_before_1:
  02D3  EDB1          	 cpir
  02D5  15            	 dec D
  02D6  20FB          	 jr nz,main_before_1
  02D8  21DF45        	 ld HL,obj
  02DB  B7            	 or A
  02DC  ED42          	 sbc HL,BC		;it's start pointa**obj++
                      	
                      	
                      	;******************door set****************************
  02DE                	main_before_15:
  02DE  E5            	 push HL		;obj
  02DF  3E83          	 ld A,83h
  02E1  010000        	 ld BC,0
                      	;main_before_2:
  02E4  EDB1          	 cpir
  02E6  03            	 inc BC
  02E7  219F46        	 ld HL,obj_xy
  02EA  B7            	 or A
  02EB  ED42          	 sbc HL,BC
  02ED  B7            	 or A
  02EE  ED42          	 sbc HL,BC
  02F0  5E            	 ld E,(HL)
  02F1  23            	 inc HL
  02F2  56            	 ld D,(HL)
  02F3  ED53D945      	 ld (pdoor_xy),DE
                      	
                      	;*****************key set*******************************
                      	
  02F7  E1            	 pop HL
  02F8  3E85          	 ld A,85h
  02FA  010000        	 ld BC,0
                      	;main_before_3:
  02FD  EDB1          	 cpir
  02FF  03            	 inc BC
  0300  219F46        	 ld HL,obj_xy
  0303  B7            	 or A
  0304  ED42          	 sbc HL,BC
  0306  B7            	 or A
  0307  ED42          	 sbc HL,BC
  0309  5E            	 ld E,(HL)
  030A  23            	 inc HL
  030B  56            	 ld D,(HL)
  030C  ED53DB45      	 ld (pkey_xy),DE
                      	
                      	;*********************obj cross gil********************
                      	
  0310  2A6C47        	 ld HL,(gil_xy)
  0313  4D            	 ld C,L
  0314  44            	 ld B,H
  0315  219F46        	 ld HL,obj_xy
  0318                	main_before_gil:
  0318  E5            	 push HL
  0319  5E            	 ld E,(HL)
  031A  23            	 inc HL
  031B  56            	 ld D,(HL)
  031C  EB            	 ex DE,HL
  031D  B7            	 or A
  031E  ED42          	 sbc HL,BC
  0320  E1            	 pop HL
  0321  2804          	 jr z,main_before_gil_z
  0323  23            	 inc HL
  0324  23            	 inc HL
  0325  18F1          	 jr main_before_gil
  0327                	main_before_gil_z:
  0327  23            	 inc HL
  0328  23            	 inc HL
  0329  7E            	 ld A,(HL)
  032A  B7            	 or A
  032B  C20B02        	 jp nz,stating_obj
  032E  C35F03        	 jp main
                      	
                      	
                      	
                      	
                      	
                      	
                      	
  0331                	stating_ms1:
  0331  47455420524541	 db "GET READY"
  033A                	stating_ms2:
  033A  504C4159455220	 db "PLAYER ONE"
  0344                	stating_msf:
  0344  464C4F4F52    	 db "FLOOR"
  0349                	continue_ms:
  0349  53454C45435420	 db "SELECT START FLOOR"
  035B                	wall_grp:
  035B  FFFFFF        	 db 0ffh,0ffh,0ffh
  035E                	pole_grp:
  035E  01            	 db 1h
                      	;**************************************************************************************
                      	;************************************Main*********************************************
                      	;**************************************************************************************
  035F                	main:
  035F  CDBF0A        	 call grp_o
                      	; call tim30
  0362  3E30          	 ld A,48
  0364  327303        	 ld (count+1),A
  0367  219F46        	 ld HL,obj_xy
  036A  DD210F46      	 ld IX,obj_hp
  036E  FD21FF46      	 ld IY,obj_st2
  0372                	mains:
                      	
  0372                	count:
  0372  3E00          	 ld A,overwrite
  0374  B7            	 or A
  0375  CA5F03        	 jp z,main
                      	;unknown_ID_throght(0)
  0378  DD7ED0        	 ld A,(IX-48)
  037B  B7            	 or A
  037C  CAE409        	 jp z,mains_end
                      	;count out then main
                      	
                      	;graph_delete
                      	
  037F  E5            	 push HL		;>
  0380  5E            	 ld E,(HL)
  0381  23            	 inc HL
  0382  56            	 ld D,(HL)
  0383  CD3A0F        	 call grp_del
  0386  E1            	 pop HL		;<
                      	;hp_zero_throght
                      	
  0387  DD7E00        	 ld A,(IX)
  038A  B7            	 or A
  038B  CAE409        	 jp z,mains_end
                      	
                      	
                      	
                      	
                      	;******************************ivent action **********************
                      	 
  038E  DD7ED0        	 ld A,(IX-48)
  0391  47            	 ld B,A
  0392  E6E0          	 and 0e0h
  0394  C21404        	 jp nz,st_action
  0397  78            	 ld A,B
  0398  FE0A          	 cp 0ah
  039A  CA1206        	 jp z,spells_action
  039D  FE0B          	 cp 0bh
  039F  CA1206        	 jp z,spells_action
                      	
                      	;wp
  03A2  DD7E30        	 ld A,(IX+48)
  03A5  B7            	 or A
                      	
                      	;wp=0
  03A6  CAB803        	 jp z,st_check
                      	
                      	
                      	
                      	;wp>0
  03A9  3D            	 dec A
  03AA  DD7730        	 ld (IX+48),A
  03AD  DD7ED0        	 ld A,(IX-48);(Syubetsu)
  03B0  CB67          	 bit 4,A
  03B2  CAB904        	 jp z,sraim_move3_e;(suraimuGPRINT)
  03B5  C35005        	 jp wizard_move_e_wpp
                      	; jp wizard_act_e
                      	; jp nz,mains_end
                      	; jp st_check
  03B8                	st_check:
  03B8  DD7E60        	 ld A,(IX+96)
  03BB  B7            	 or A
  03BC  C20D04        	 jp nz,st_dec
                      	
                      	;wp=0,st=0
                      	;wp setting((di)=move lutin)
                      	
  03BF  DD7ED0        	 ld A,(IX-48);(Syurui)
  03C2  CB67          	 bit 4,A
  03C4  2808          	 jr z,wp_str_b
  03C6  ED5F          	 ld A,R;		(wizard)
  03C8  E61F          	 and 00011111b
  03CA  CBEF          	 set 5,A
  03CC  182A          	 jr wp_str
  03CE                	wp_str_b:
  03CE  F5            	 push AF
  03CF  ED5F          	 ld A,R
  03D1  E67F          	 and 7fh
  03D3  47            	 ld B,A
  03D4  ED5F          	 ld A,R
  03D6  E67F          	 and 7fh
  03D8  80            	 add A,B
  03D9  47            	 ld B,A
  03DA  F1            	 pop AF
  03DB  FE02          	 cp 2
  03DD  3816          	 jr c,wp_G
  03DF  280F          	 jr z,wp_B
  03E1  FE04          	 cp 4
  03E3  78            	 ld A,B
  03E4  3806          	 jr c,wp_R
  03E6  2804          	 jr z,wp_BL
  03E8                	wp_D:
  03E8                	wp_DY:
  03E8  E608          	 and 8
  03EA  180C          	 jr wp_str
  03EC                	wp_BL:
  03EC                	wp_R:
  03EC  E610          	 and 16
  03EE  1808          	 jr wp_str
  03F0                	wp_B:
  03F0  78            	 ld A,B
  03F1  E608          	 and 8
  03F3  1803          	 jr wp_str
  03F5                	wp_G:
  03F5  78            	 ld A,B
  03F6  E610          	 and 16
  03F8                	wp_str:
  03F8  C608          	 add A,8
  03FA  DD7730        	 ld (IX+48),A
  03FD  3E19          	 ld A,25
  03FF  DD7760        	 ld (IX+96),A
                      	
  0402  DD7ED0        	 ld A,(IX-48);(Syubetsu)
  0405  CB67          	 bit 4,A
  0407  CAB904        	 jp z,sraim_move3_e;(suraimuGPRINT)
  040A  C35005        	 jp wizard_move_e_wpp;(wizard not print)mains_end
                      	; jp Egraph;
                      	
                      	
                      	
                      	;wp=0,st=x
  040D                	st_dec:
  040D  3D            	 dec A
  040E  DD7760        	 ld (IX+96),A
  0411  C34204        	 jp sraim_or_wiz_action
                      	 
                      	 
                      	;***********************************knight,quox,ivent*********************************
  0414                	st_action:;Individual action
                      	; call bls
  0414  DD7ED0        	 ld A,(IX-48)
  0417  CB6F          	 bit 5,A
  0419  C21207        	 jp nz,knight_action
  041C  FE8F          	 cp 8fh
  041E  CA5708        	 jp z,gil_action
  0421  C3E409        	 jp mains_end
                      	
  0424  32F000        	 ld (0f0h),A
  0427  DD7ED0        	 ld A,(IX-48)
  042A  32F400        	 ld (0f4h),A
  042D  DD7E00        	 ld A,(IX-0)
  0430  32F500        	 ld (0f5h),A
  0433  DD7E30        	 ld A,(IX+48)
  0436  32F600        	 ld (0f6h),A
  0439  DD7E60        	 ld A,(IX+96)
  043C  32F700        	 ld (0f7h),A
  043F  C3FC09        	 jp retP
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	;****************************************************************************
                      	;*********************************sraim or wiz*******************************
                      	
  0442                	sraim_or_wiz_action:;HL=obj_xy++
  0442  DDCBD066      	 bit 4,(IX-48);(NO.)
  0446  C2EE04        	 jp nz,wiz_action
                      	
                      	 ;;;;
                      	 ;;;;
  0449  DD7E60        	 ld A,(IX+96);(st)
                      	 
                      	; ld (0f0h),A
                      	; jp retP
                      	
  044C  FE09          	 cp 9
  044E  280B          	 jr z,sraim_move1_B
  0450  FE05          	 cp 5
  0452  2823          	 jr z,sraim_move1
  0454  FE01          	 cp 1
  0456  283F          	 jr z,sraim_move3
  0458  C3B904        	 jp sraim_move3_e;mains_end
                      	
                      	
  045B                	sraim_move1_B:
  045B  CDF90B        	 call wall_ck
  045E  2817          	 jr z,sraim_move1
  0460  23            	 inc HL
  0461  CBBE          	 res 7,(HL)
  0463  CBB6          	 res 6,(HL)
  0465  ED5F          	 ld A,R
                      	; rla
  0467  1F            	 rra
  0468  1F            	 rra
  0469  1F            	 rra
  046A  E6C0          	 and 0c0h
  046C  B6            	 or (HL)
  046D  77            	 ld (HL),A
  046E  2B            	 dec HL
  046F  3E50          	 ld A,80
  0471  DD7760        	 ld (IX+96),A
  0474  C3B904        	 jp sraim_move3_e
  0477                	sraim_move1:
                      	;graph_delete
                      	
                      	; push HL		;>
                      	; call bls
                      	; ld E,(HL)
                      	; inc HL
                      	; ld D,(HL)
                      	; call grp_del
                      	; pop HL		;<
                      	
                      	
  0477  23            	 inc HL
  0478  7E            	 ld A,(HL)
  0479  E6C0          	 and 0c0h
  047B  280B          	 jr z,sraim_move1_u
  047D  FE80          	 cp 80h
  047F  380C          	 jr c,sraim_move1_r
  0481  280F          	 jr z,sraim_move1_d
  0483                	sraim_move1_l:
  0483  2B            	 dec HL
  0484  35            	 dec (HL)
  0485  35            	 dec (HL)
  0486  1831          	 jr sraim_move3_e
  0488                	sraim_move1_u:
  0488  35            	 dec (HL)
  0489  35            	 dec (HL)
  048A  2B            	 dec HL
  048B  182C          	 jr sraim_move3_e
  048D                	sraim_move1_r:
  048D  2B            	 dec HL
  048E  34            	 inc (HL)
  048F  34            	 inc (HL)
  0490  1827          	 jr sraim_move3_e
  0492                	sraim_move1_d:
  0492  34            	 inc (HL)
  0493  34            	 inc (HL)
  0494  2B            	 dec HL
                      	
  0495  1822          	 jr sraim_move3_e
                      	
                      	
  0497                	sraim_move3:
                      	
  0497  23            	 inc HL
  0498  7E            	 ld A,(HL)
  0499  E6C0          	 and 0c0h
  049B  280C          	 jr z,sraim_move3_u
  049D  FE80          	 cp 80h
  049F  380E          	 jr c,sraim_move3_r
  04A1  2812          	 jr z,sraim_move3_d
  04A3                	sraim_move3_l:
  04A3  2B            	 dec HL
  04A4  35            	 dec (HL)
  04A5  35            	 dec (HL)
  04A6  35            	 dec (HL)
  04A7  1810          	 jr sraim_move3_e
  04A9                	sraim_move3_u:
  04A9  35            	 dec (HL)
  04AA  35            	 dec (HL)
  04AB  35            	 dec (HL)
  04AC  2B            	 dec HL
  04AD  180A          	 jr sraim_move3_e
  04AF                	sraim_move3_r:
  04AF  2B            	 dec HL
  04B0  34            	 inc (HL)
  04B1  34            	 inc (HL)
  04B2  34            	 inc (HL)
  04B3  1804          	 jr sraim_move3_e
  04B5                	sraim_move3_d:
  04B5  34            	 inc (HL)
  04B6  34            	 inc (HL)
  04B7  34            	 inc (HL)
  04B8  2B            	 dec HL
  04B9                	sraim_move3_e:
  04B9  11E715        	 ld DE,graph_sraimd
  04BC                	Egraph:;(DE=)
  04BC  ED53C504      	 ld (Egraph_put+1),DE
  04C0  E5            	 push HL		;>
  04C1  5E            	 ld E,(HL)
  04C2  23            	 inc HL
  04C3  56            	 ld D,(HL)
  04C4                	Egraph_put:
  04C4  210000        	 ld HL,overwrite
  04C7  CDAE0E        	 call grp_set
  04CA  E1            	 pop HL			;<
  04CB  DD7ED0        	 ld A,(IX-48)
  04CE  E6F8          	 and 11111000b
  04D0  CAD404        	 jp z,sraim_cross_ck;
  04D3  C9            	 ret
                      	 
  04D4                	sraim_cross_ck:
  04D4  3A6347        	 ld A,(gil_st2)
  04D7  CB7F          	 bit 7,A		;(gil sworud MIRU)
  04D9  2808          	 jr z,s1
  04DB  CDCA0B        	 call cross_ck_a;s
  04DE  DCEC0B        	 call c,cha_kill;(suraim HP=0)
  04E1  1808          	 jr s2
  04E3                	s1:;(gil_st=0-x)
  04E3  CDCA0B        	 call cross_ck_a
  04E6  3003          	 jr nc,s2
  04E8  C3C209        	 jp gil_killing
                      	 
  04EB                	s2:
                      	; jp c,retP
  04EB  C3E409        	 jp mains_end
                      	
                      	
                      	;******************wiz actions**Main***********************
  04EE                	wiz_action:
  04EE  FE18          	 cp 24
  04F0  CA1C05        	 jp z,wiz_ap
  04F3  FE0C          	 cp 12
  04F5  CA3E05        	 jp z,wiz_sp
  04F8  FD7E00        	 ld A,(IY)
  04FB  B7            	 or A
  04FC  C24405        	 jp nz,wiz_dec
  04FF                	wiz_dec2:
  04FF  11FF15        	 ld DE,magic
  0502  CDBC04        	 call Egraph
                      	;********************cross chack wiz*******************
  0505                	wizard_cross_ck;
  0505  3A6347        	 ld A,(gil_st2)
  0508  CB7F          	 bit 7,A		;(gil sworud MIRU)
  050A  2808          	 jr z,ss1
  050C  CDCA0B        	 call cross_ck_a;s
  050F  DCEC0B        	 call c,cha_kill;(suraim HP=0)
  0512  1805          	 jr ss2
  0514                	ss1:;(gil_st=0-x)
  0514  CDCA0B        	 call cross_ck_a
  0517  3000          	 jr nc,wizard_end
                      	; jp gil_killing
  0519                	ss2:
  0519                	wizard_end:
                      	;********************wiz end***************************
  0519  C3E409        	 jp mains_end
                      	
  051C                	wiz_ap:
                      	
  051C                	gil_notaction_f:
  051C  3A5F47        	 ld A,(gil_button)
  051F  DD3430        	 inc (IX+48)
  0522  DD3460        	 inc (IX+96)
  0525  E6C3          	 and 11000011b
  0527  CA1905        	 jp z,wizard_end
  052A  DD3530        	 dec (IX+48)
  052D  DD3560        	 dec (IX+96)
                      	 
  0530  DD7E60        	 ld A,(IX+96)
  0533  3E0A          	 ld A,10
  0535  FD7700        	 ld (IY),A
  0538  CD5305        	 call wiz_locate
  053B  C3FF04        	 jp wiz_dec2
  053E                	wiz_sp:
  053E  CDD005        	 call spell_create
  0541  C3FF04        	 jp wiz_dec2
  0544                	wiz_dec:
  0544  DD3460        	 inc (IX+96)
  0547  FD3500        	 dec (IY)
  054A  FD7E00        	 ld A,(IY)
  054D  C3FF04        	 jp wiz_dec2
                      	
                      	;***********************wp>0 then noting*********************
  0550                	wizard_move_e_wpp;wp>0
  0550  C3E409        	 jp mains_end
                      	
                      	;***********************wiz_locate**************************
  0553                	wiz_locate:
  0553  E5            	 push HL	;>
  0554  216C47        	 ld HL,gil_xy
  0557  5E            	 ld E,(HL);x
  0558  23            	 inc HL
  0559  56            	 ld D,(HL);y
                      	
                      	; ld A,E
                      	; ld (0f0h),A
                      	; ld A,D
                      	; ld (0f1h),A
                      	 
  055A  E1            	 pop HL		;<
  055B  ED5F          	 ld A,R
  055D  4F            	 ld C,A
  055E  ED5F          	 ld A,R
  0560  E603          	 and 00000011b
  0562  B7            	 or A
  0563  CA8105        	 jp z,wiz_locate_left
  0566  FE02          	 cp 2
  0568  DA9805        	 jp c,wiz_locate_down
  056B  CAAC05        	 jp z,wiz_locate_right
  056E                	wiz_locate_up:
  056E  7A            	 ld A,D
  056F  E63F          	 and 00111111b
  0571  D60E          	 sub 14
  0573  38DE          	 jr c,wiz_locate
  0575  F680          	 or 10000000b
  0577  57            	 ld D,A
                      	 
  0578  7B            	 ld A,E
  0579  77            	 ld (HL),A
  057A  23            	 inc HL
  057B  7A            	 ld A,D
  057C  77            	 ld (HL),A
  057D  2B            	 dec HL
                      	 
  057E  C3C405        	 jp wiz_locate_end
  0581                	wiz_locate_left;
  0581  7B            	 ld A,E
  0582  D60E          	 sub 14
  0584  FE1E          	 cp 30
  0586  38CB          	 jr c,wiz_locate
  0588  5F            	 ld E,A
                      	 
  0589  7A            	 ld A,D
  058A  E63F          	 and 00111111b
  058C  F640          	 or 01000000b
  058E  57            	 ld D,A
                      	 
  058F  7B            	 ld A,E
  0590  77            	 ld (HL),A
  0591  23            	 inc HL
  0592  7A            	 ld A,D
  0593  77            	 ld (HL),A
  0594  2B            	 dec HL
                      	 
  0595  C3C405        	 jp wiz_locate_end
  0598                	wiz_locate_down;
  0598  7A            	 ld A,D
  0599  E63F          	 and 00111111b
  059B  7A            	 ld A,D
  059C  C60E          	 add A,14
  059E  FE30          	 cp 47+1
  05A0  30B1          	 jr nc,wiz_locate
  05A2  57            	 ld D,A
                      	 
  05A3  7B            	 ld A,E
  05A4  77            	 ld (HL),A
  05A5  23            	 inc HL
  05A6  7A            	 ld A,D
  05A7  77            	 ld (HL),A
  05A8  2B            	 dec HL
                      	 
  05A9  C3C405        	 jp wiz_locate_end
  05AC                	wiz_locate_right;
  05AC  7B            	 ld A,E
  05AD  C60E          	 add A,14
  05AF  FE88          	 cp 135+1
  05B1  D25305        	 jp nc,wiz_locate
  05B4  5F            	 ld E,A
                      	 
  05B5  7A            	 ld A,D
  05B6  E63F          	 and 00111111b
  05B8  F6C0          	 or 11000000b
  05BA  57            	 ld D,A
                      	 
  05BB  7B            	 ld A,E
  05BC  77            	 ld (HL),A
  05BD  23            	 inc HL
  05BE  7A            	 ld A,D
  05BF  77            	 ld (HL),A
  05C0  2B            	 dec HL
                      	 
  05C1  C3C405        	 jp wiz_locate_end
                      	 
                      	;
  05C4                	wiz_locate_end:
  05C4  CD8C0C        	 call wall_mod
  05C7  7E            	 ld A,(HL)
  05C8  91            	 sub C
  05C9  77            	 ld (HL),A 
  05CA  23            	 inc HL		;>
  05CB  7E            	 ld A,(HL)
  05CC  90            	 sub B
  05CD  77            	 ld (HL),A
  05CE  2B            	 dec HL		;<
  05CF  C9            	 ret
                      	 
                      	;******************************spell create*************************** 
                      	;******************************spell create*************************** 
  05D0                	spell_create:
  05D0  E5            	 push HL
  05D1  AF            	 xor A
  05D2  21DF45        	 ld HL,obj
  05D5  AF            	 xor A
  05D6  010000        	 ld BC,0
  05D9  EDB1          	 cpir		;BC<0
  05DB  03            	 inc BC
                      	 
                      	 
                      	; ld (HL),0	;chr clr
  05DC  2B            	 dec HL		;spell address
  05DD  DD7ED0        	 ld A,(IX-48)
  05E0  FE13          	 cp 13h
  05E2  2804          	 jr z,spellB
  05E4  360A          	 ld (HL),0Ah
  05E6  1802          	 jr spellsetok
  05E8                	spellB:
  05E8  360B          	 ld (HL),0Bh
  05EA                	spellsetok:
                      			;hp
  05EA  113000        	 ld DE,48
  05ED  19            	 add HL,DE
  05EE  3601          	 ld (HL),1
                      	 		;st2
  05F0  11F000        	 ld DE,48*5
  05F3  19            	 add HL,DE
  05F4  3600          	 ld (HL),0
                      	 
  05F6  E1            	 pop HL
                      	 
                      	; ld (0f4h),HL
                      	
  05F7  7E            	 ld A,(HL)
  05F8  5F            	 ld E,A
  05F9  23            	 inc HL
  05FA  7E            	 ld A,(HL)
  05FB  57            	 ld D,A
  05FC  2B            	 dec HL
                      	 
  05FD  E5            	 push HL
  05FE  210000        	 ld HL,0
  0601  B7            	 or A
  0602  ED42          	 sbc HL,BC;xy_countor
  0604  B7            	 or A
  0605  ED42          	 sbc HL,BC
  0607  019F46        	 ld BC,obj_xy
  060A  09            	 add HL,BC
                      	 
                      	 
  060B  7B            	 ld A,E
  060C  77            	 ld (HL),A
  060D  23            	 inc HL
  060E  7A            	 ld A,D
  060F  77            	 ld (HL),A
                      	 
                      	; ld (0f0h),HL
                      	; ld (0f2h),BC
                      	 
                      	 
  0610  E1            	 pop HL
  0611  C9            	 ret
                      	;******************************spell action****************************
  0612                	spells_action:
  0612  FD7E00        	 ld A,(IY)
  0615  FE01          	 cp 1
  0617  CA5B06        	 jp z,spells_action1
  061A  FE02          	 cp 2
  061C  CA8406        	 jp z,spells_action2
                      	
  061F  CD8C0C        	 call wall_mod
  0622  78            	 ld A,B
  0623  B7            	 or A
  0624  C2FF06        	 jp nz,spells_action_delete
  0627  79            	 ld A,C
  0628  B7            	 or A
  0629  C2FF06        	 jp nz,spells_action_delete
                      	 
  062C  CDF90B        	 call wall_ck
  062F  C2B106        	 jp nz,spells_action_dol
  0632                	spells_action_wiz:
  0632  23            	 inc HL
  0633  7E            	 ld A,(HL)
  0634  2B            	 dec HL
  0635  E6C0          	 and 11000000b
  0637  280A          	 jr z,spells_action_u
  0639  FE80          	 cp 80h
  063B  380C          	 jr c,spells_action_r
  063D  280E          	 jr z,spells_action_d
  063F                	spells_action_l:
  063F  35            	 dec (HL)
  0640  35            	 dec (HL)
  0641  1810          	 jr spells_action_urdl
  0643                	spells_action_u:
  0643  23            	 inc HL
  0644  35            	 dec (HL)
  0645  35            	 dec (HL)
  0646  2B            	 dec HL
  0647  180A          	 jr spells_action_urdl
  0649                	spells_action_r:
  0649  34            	 inc (HL)
  064A  34            	 inc (HL)
  064B  1806          	 jr spells_action_urdl
  064D                	spells_action_d:
  064D  23            	 inc HL
  064E  34            	 inc (HL)
  064F  34            	 inc (HL)
  0650  2B            	 dec HL
  0651  1800          	 jr spells_action_urdl
  0653                	spells_action_urdl:
  0653  3E01          	 ld A,1
  0655  FD7700        	 ld (IY),A
  0658  C3BE06        	 jp spells_actionend
                      	 
                      	 
                      	 
  065B                	spells_action1:
  065B  23            	 inc HL
  065C  7E            	 ld A,(HL)
  065D  2B            	 dec HL
  065E  E6C0          	 and 11000000b
  0660  280A          	 jr z,spells_action1_u
  0662  FE80          	 cp 80h
  0664  380C          	 jr c,spells_action1_r
  0666  280E          	 jr z,spells_action1_d
  0668                	spells_action1_l:
  0668  35            	 dec (HL)
  0669  35            	 dec (HL)
  066A  1810          	 jr spells_action1_urdl
  066C                	spells_action1_u:
  066C  23            	 inc HL
  066D  35            	 dec (HL)
  066E  35            	 dec (HL)
  066F  2B            	 dec HL
  0670  180A          	 jr spells_action1_urdl
  0672                	spells_action1_r:
  0672  34            	 inc (HL)
  0673  34            	 inc (HL)
  0674  1806          	 jr spells_action1_urdl
  0676                	spells_action1_d:
  0676  23            	 inc HL
  0677  34            	 inc (HL)
  0678  34            	 inc (HL)
  0679  2B            	 dec HL
  067A  1800          	 jr spells_action1_urdl
  067C                	spells_action1_urdl:
  067C  3E02          	 ld A,2
  067E  FD7700        	 ld (IY),A
  0681  C3BE06        	 jp spells_actionend
                      	 
                      	 
                      	
  0684                	spells_action2:
  0684  23            	 inc HL
  0685  7E            	 ld A,(HL)
  0686  2B            	 dec HL
  0687  E6C0          	 and 11000000b
  0689  280B          	 jr z,spells_action2_u
  068B  FE80          	 cp 80h
  068D  380E          	 jr c,spells_action2_r
  068F  2811          	 jr z,spells_action2_d
  0691                	spells_action2_l:
  0691  35            	 dec (HL)
  0692  35            	 dec (HL)
  0693  35            	 dec (HL)
  0694  1813          	 jr spells_action2_urdl
  0696                	spells_action2_u:
  0696  23            	 inc HL
  0697  35            	 dec (HL)
  0698  35            	 dec (HL)
  0699  35            	 dec (HL)
  069A  2B            	 dec HL
  069B  180C          	 jr spells_action2_urdl
  069D                	spells_action2_r:
  069D  34            	 inc (HL)
  069E  34            	 inc (HL)
  069F  34            	 inc (HL)
  06A0  1807          	 jr spells_action2_urdl
  06A2                	spells_action2_d:
  06A2  23            	 inc HL
  06A3  34            	 inc (HL)
  06A4  34            	 inc (HL)
  06A5  34            	 inc (HL)
  06A6  2B            	 dec HL
  06A7  1800          	 jr spells_action2_urdl
  06A9                	spells_action2_urdl:
  06A9  3E00          	 ld A,0
  06AB  FD7700        	 ld (IY),A
  06AE  C3BE06        	 jp spells_actionend
  06B1                	spells_action_dol:
  06B1  DD7ED0        	 ld A,(IX-48)
  06B4  FE0B          	 cp 0bh
  06B6  E5            	 push HL
  06B7  CCBB0C        	 call z,matk_action
  06BA  E1            	 pop HL
  06BB  C3FF06        	 jp spells_action_delete
                      	 
  06BE                	spells_actionend:
  06BE                	spells_action_cross
                      	 
                      	
                      	;********************cross chack spell*******************
  06BE                	spell_cross_ck;
  06BE  CDCA0B        	 call cross_ck_a;s
  06C1  3033          	 jr nc,spell_cross_ck_end
  06C3                	spell_cross_ck_1:
                      	
  06C3  3A6D47        	 ld A,(gil_xy+1)
  06C6  E6C0          	 and 11000000b
  06C8  17            	 rla
  06C9  17            	 rla
  06CA  17            	 rla
  06CB  47            	 ld B,A
  06CC  23            	 inc HL
  06CD  7E            	 ld A,(HL)
  06CE  2B            	 dec HL
  06CF  E6C0          	 and 11000000b
  06D1  17            	 rla
  06D2  17            	 rla
  06D3  17            	 rla
  06D4  3C            	 inc A
  06D5  3C            	 inc A
  06D6  E603          	 and 00000011b
  06D8  4F            	 ld C,A
  06D9  C5            	 push BC
                      	
  06DA  3A6347        	 ld A,(gil_st2)
  06DD  CB7F          	 bit 7,A		;(gil sworud MIRU)
  06DF  2009          	 jr nz,spell_cross_ck_s
  06E1                	spell_cross_ck_n:
  06E1  C1            	 pop BC
  06E2  79            	 ld A,C
  06E3  A8            	 xor B				;urdl = turdl
  06E4  CAFF06        	 jp z,spells_action_delete
  06E7  C3C209        	 jp gil_killing
  06EA                	spell_cross_ck_s:
  06EA  C1            	 pop BC
  06EB  79            	 ld A,C
  06EC  3C            	 inc A
  06ED  E603          	 and 00000011b
  06EF  A8            	 xor B				;urdl = turdl
  06F0  CAFF06        	 jp z,spells_action_delete
  06F3  C3C209        	 jp gil_killing
  06F6                	spell_cross_ck_end:
  06F6  111716        	 ld DE,graph_spell
  06F9  CDBC04        	 call Egraph;call Egraph
  06FC  C3E409        	 jp mains_end
                      	 
  06FF                	spells_action_delete:
  06FF  AF            	 xor A
  0700  DD77D0        	 ld (IX-48),A
  0703  DD7700        	 ld (IX),A
  0706  FD7700        	 ld (IY),A
  0709  3600          	 ld (HL),0
  070B  23            	 inc HL
  070C  3600          	 ld (HL),0
  070E  2B            	 dec HL
  070F  C3E409        	 jp mains_end
                      	 
                      	 
                      	
                      	 
                      	;***************************************************************
                      	;**************************knight action************************
  0712                	knight_action:;HL=obj_xy++
  0712  CD8C0C        	 call wall_mod
  0715  78            	 ld A,B
  0716  B7            	 or A
  0717  C24D07        	 jp nz,knight_move
  071A  79            	 ld A,C
  071B  B7            	 or A
  071C  C24D07        	 jp nz,knight_move
                      	
  071F  5E            	 ld E,(HL)
  0720  23            	 inc HL
  0721  7E            	 ld A,(HL)
  0722  E63F          	 and 00111111b
  0724  56            	 ld D,(HL)
  0725  2B            	 dec HL
                      	 
  0726  E5            	 push HL	;>
  0727  2A6C47        	 ld HL,(gil_xy)
  072A  7C            	 ld A,H
  072B  E63F          	 and 00111111b
  072D  67            	 ld H,A
  072E  ED52          	 sbc HL,DE
  0730  CA4307        	 jp z,knight_xy
                      	 
                      	 
  0733                	knight_nz:
  0733  E1            	 pop HL
  0734  CDF90B        	 call wall_ck
  0737  CDF507        	 call ck_rightwall
  073A  CA4D07        	 jp z,knight_move
  073D  CD7707        	 call front_wall_ck
                      	 
  0740  C34D07        	 jp knight_move
                      	 
                      	 
                      	 
                      	 
                      	 
  0743                	knight_xy:
  0743  7A            	 ld A,D
  0744  E1            	 pop HL		;<
  0745  F6C0          	 or 11000000
  0747  23            	 inc HL
  0748  77            	 ld (HL),A
  0749  2B            	 dec HL
  074A  C34D07        	 jp knight_move
                      	
                      	
  074D                	knight_move:
  074D                	knight_action_urdl:;a=0~3
  074D  23            	 inc HL
  074E  7E            	 ld A,(HL)
  074F  2B            	 dec HL
  0750  E6C0          	 and 11000000b
  0752  280A          	 jr z,knight_action_up
  0754  FE80          	 cp 80h
  0756  380C          	 jr c,knight_action_ri
  0758  280E          	 jr z,knight_action_do
  075A                	knight_action_le:
  075A  35            	 dec (HL)
  075B  C36E07        	 jp knight_action_end
  075E                	knight_action_up:
  075E  23            	 inc HL
  075F  35            	 dec (HL)
  0760  2B            	 dec HL
  0761  C36E07        	 jp knight_action_end
  0764                	knight_action_ri:
  0764  34            	 inc (HL)
  0765  C36E07        	 jp knight_action_end
  0768                	knight_action_do:
  0768  23            	 inc HL
  0769  34            	 inc (HL)
  076A  2B            	 dec HL
  076B  C36E07        	 jp knight_action_end
                      	
  076E                	knight_action_end:
  076E  112F16        	 ld DE,graph_n_knightu
  0771  CDBC04        	 call Egraph
  0774  C3E409        	 jp mains_end
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
  0777                	front_wall_ck:
  0777  11F007        	 ld DE,front_wall_ck_end
  077A  D5            	 push DE
  077B  7E            	 ld A,(HL)
  077C  32F107        	 ld (front_wall_ck_end+1),A
  077F  23            	 inc HL
  0780  7E            	 ld A,(HL)
  0781  E63F          	 and 00111111b
  0783  32F307        	 ld (front_wall_ck_end+3),A
  0786  2B            	 dec HL
  0787  E6C0          	 and 11000000b
  0789  282E          	 jr z,ck_front_wall_u
  078B  FE80          	 cp 80h
  078D  380E          	 jr c,ck_front_wall_r
  078F  2818          	 jr z,ck_front_wall_d
  0791                	ck_front_wall_l:
  0791  7E            	 ld A,(HL)
  0792  D607          	 sub 7
  0794  FE1E          	 cp X0
  0796  DAE407        	 jp c,urdl_rand
  0799  77            	 ld (HL),A
  079A  C3C707        	 jp ck_front_wall_turn
                      	 
  079D                	ck_front_wall_r:
  079D  7E            	 ld A,(HL)
  079E  C607          	 add A,7
  07A0  FE88          	 cp 136
  07A2  D2E407        	 jp nc,urdl_rand
  07A5  77            	 ld (HL),A
  07A6  C3C707        	 jp ck_front_wall_turn
                      	 
  07A9                	ck_front_wall_d:
  07A9  23            	 inc HL
  07AA  7E            	 ld A,(HL)
  07AB  E63F          	 and 00111111b
  07AD  2B            	 dec HL
  07AE  C607          	 add A,7
  07B0  FE2B          	 cp 43
  07B2  D2E407        	 jp nc,urdl_rand
  07B5  77            	 ld (HL),A
  07B6  C3C707        	 jp ck_front_wall_turn
                      	 
  07B9                	ck_front_wall_u:
  07B9  23            	 inc HL
  07BA  7E            	 ld A,(HL)
  07BB  E63F          	 and 00111111b
  07BD  2B            	 dec HL
  07BE  D607          	 sub 7
  07C0  DAE407        	 jp c,urdl_rand
  07C3  77            	 ld (HL),A
  07C4  C3C707        	 jp ck_front_wall_turn
                      	
                      	
  07C7                	ck_front_wall_turn:
  07C7  CD0508        	 call right_turn
  07CA  CDF90B        	 call wall_ck
  07CD  C8            	 ret z
  07CE  CD1408        	 call left_turn
  07D1  CDF90B        	 call wall_ck
  07D4  C8            	 ret z
  07D5  CD1408        	 call left_turn
  07D8  CDF90B        	 call wall_ck
  07DB  C8            	 ret z
  07DC  CD0508        	 call right_turn
  07DF  CD0508        	 call right_turn
  07E2  18E3          	 jr ck_front_wall_turn
                      	
                      	
  07E4                	urdl_rand:
  07E4  CD2D0A        	 call rand4
  07E7  23            	 inc HL
  07E8  47            	 ld B,A
  07E9  7E            	 ld A,(HL)
  07EA  E63F          	 and 00111111b
  07EC  B0            	 or B
  07ED  77            	 ld (HL),A
  07EE  2B            	 dec HL
  07EF  C9            	 ret;jp front_wall_ck
                      	
  07F0                	front_wall_ck_end:
  07F0  1E00          	 ld E,overwrite
  07F2  1600          	 ld D,overwrite
                      	 
  07F4  C9            	 ret
                      	
                      	
                      	
                      	
                      	
                      	
  07F5                	ck_rightwall:
  07F5  CD0508        	 call right_turn
  07F8  CDF90B        	 call wall_ck
  07FB  2001          	 jr nz,ck_rightwall_nz
  07FD  C9            	 ret
  07FE                	ck_rightwall_nz:
  07FE  CD1408        	 call left_turn
  0801  3E01          	 ld A,1
  0803  B7            	 or A
  0804  C9            	 ret
                      	
  0805                	right_turn:
  0805  23            	 inc HL
  0806  7E            	 ld A,(HL)
  0807  47            	 ld B,A
  0808  E63F          	 and 00111111b
  080A  77            	 ld (HL),A
  080B  78            	 ld A,B
  080C  E6C0          	 and 11000000b
  080E  C640          	 add A,40h
  0810  B6            	 or (HL)
  0811  77            	 ld (HL),A
  0812  2B            	 dec HL
  0813  C9            	 ret
  0814                	left_turn:
  0814  23            	 inc HL
  0815  7E            	 ld A,(HL)
  0816  47            	 ld B,A
  0817  E63F          	 and 00111111b
  0819  77            	 ld (HL),A
  081A  78            	 ld A,B
  081B  E6C0          	 and 11000000b
  081D  D640          	 sub 40h
  081F  E6C0          	 and 11000000b
  0821  B6            	 or (HL)
  0822  77            	 ld (HL),A
  0823  2B            	 dec HL
  0824  C9            	 ret
                      	
                      	
                      	
                      	;*************************hp dec*****************************
  0825                	HP_dec:
  0825  3A6747        	 ld A,(gil_sword)
  0828  FE02          	 cp 2
  082A  DD7E00        	 ld A,(IX)
  082D  2003          	 jr nz,HP_dec1
  082F  3D            	 dec A
  0830  2801          	 jr z,HP_dec2
  0832                	HP_dec1:
  0832  3D            	 dec A
  0833                	HP_dec2:
  0833  DD7700        	 ld (IX),A
  0836  280B          	 jr z,HP_rec
  0838                	gil_HP_dec:
  0838  3A6047        	 ld A,(gil_hp)
  083B  3D            	 dec A
  083C  326047        	 ld (gil_hp),A
  083F  CAC209        	 jp z,gil_killing
  0842  C9            	 ret
                      	 
  0843                	HP_rec:
  0843  DD7E60        	 ld A,(IX+96)
  0846  47            	 ld B,A
  0847  AF            	 xor A
  0848  DD7760        	 ld (IX+96),A
  084B  3A6047        	 ld A,(gil_HP)
  084E  80            	 add A,B
  084F  3002          	 jr nc,H_recP2
  0851  3EFF          	 ld A,255
  0853                	H_recP2:
  0853  326047        	 ld (gil_HP),A
  0856  C9            	 ret
                      	
                      	
                      	;*************************gil actions*************************
  0857                	gil_action:
  0857  E5            	 push HL
                      	
                      	
  0858  3A6C47        	 ld A,(gil_xy)
  085B  5F            	 ld E,A
  085C  3A6D47        	 ld A,(gil_xy+1)
  085F  57            	 ld D,A
  0860  CD3A0F        	 call grp_del
                      	; call kwait
                      	
                      	;*************************key scanf**************************
  0863  CDE50A        	 call keysc
  0866  325F47        	 ld (gil_button),A
  0869  08            	 ex AF,AF'
                      	
                      	;************************sword back***************************
  086A  3A6347        	 ld A,(gil_st2)
  086D  B7            	 or A
  086E  C28B09        	 jp nz,gil_sword_f2
                      	;***********************sword atack****************************
  0871                	gil_action_l_b:
  0871  08            	 ex AF,AF'
  0872  CB6F          	 bit 5,A
  0874  C25209        	 jp nz,gil_sword_f
  0877  CD7509        	 call gil_sword_reset
                      	
  087A  215715        	 ld HL,graph_gil_ulf
  087D  222409        	 ld (gil_action_end-2),HL
                      	;************************urdl move*****************************
  0880                	gil_action_l:
  0880  CB47          	 bit 0,A
  0882  200F          	 jr nz,gil_left
  0884  CB4F          	 bit 1,A
  0886  202D          	 jr nz,gil_right
  0888  CB77          	 bit 6,A
  088A  204C          	 jr nz,gil_down
  088C  CB7F          	 bit 7,A
  088E  206C          	 jr nz,gil_up
                      	;*****************************noting************************
  0890  C32309        	 jp gil_action_end-3
                      	 ;************************move farse*************************
  0893                	gil_left:
  0893  3A6D47        	 ld A,(gil_xy+1);y
  0896  E63F          	 and 00111111b
  0898  CAA208        	 jp z,gil_left_l
  089B                	gil_left_s:
  089B  D607          	 sub 7
  089D  DA3F09        	 jp c,direction_p
  08A0  20F9          	 jr nz,gil_left_s
  08A2                	gil_left_l:
  08A2  3EC0          	 ld A,11000000b
  08A4  216D47        	 ld HL,gil_xy+1
  08A7  B6            	 or (HL)
  08A8  77            	 ld (HL),A
  08A9  2B            	 dec HL;ld HL,gil_xy
  08AA  CDF90B        	 call wall_ck
  08AD  B7            	 or A;
  08AE  C22309        	 jp nz,gil_action_end-3
                      	
                      	; ld HL,gil_xy
  08B1  35            	 dec (HL)
  08B2  C31C09        	 jp gil_walk
                      	
  08B5                	gil_right:
  08B5  3A6D47        	 ld A,(gil_xy+1);y
  08B8  E63F          	 and 00111111b
  08BA  CAC408        	 jp z,gil_right_l
  08BD                	gil_right_s:
  08BD  D607          	 sub 7
  08BF  DA3F09        	 jp c,direction_p
  08C2  20F9          	 jr nz,gil_right_s
  08C4                	gil_right_l:
  08C4  3E3F          	 ld A,00111111b
  08C6  216D47        	 ld HL,gil_xy+1
  08C9  A6            	 and (HL)
  08CA  77            	 ld (HL),A
  08CB  CBF6          	 set 6,(HL)
  08CD  2B            	 dec HL;ld HL,gil_xy
  08CE  CDF90B        	 call wall_ck
  08D1  B7            	 or A;
  08D2  C22309        	 jp nz,gil_action_end-3
                      	
                      	; ld HL,gil_xy
  08D5  34            	 inc (HL)
  08D6  1844          	 jr gil_walk
                      	
  08D8                	gil_down:
  08D8  3A6C47        	 ld A,(gil_xy);x
  08DB  D61E          	 sub 30
  08DD  CAE708        	 jp z,gil_down_l
  08E0                	gil_down_s:
  08E0  D607          	 sub 7
  08E2  DA3F09        	 jp c,direction_p
  08E5  20F9          	 jr nz,gil_down_s
  08E7                	gil_down_l:
  08E7  3E3F          	 ld A,00111111b
  08E9  216D47        	 ld HL,gil_xy+1
  08EC  A6            	 and (HL)
  08ED  77            	 ld (HL),A
  08EE  CBFE          	 set 7,(HL)
  08F0  2B            	 dec HL;ld HL,gil_xy
  08F1  CDF90B        	 call wall_ck
  08F4  B7            	 or A;
  08F5  C22309        	 jp nz,gil_action_end-3
                      	
                      	; ld HL,gil_xy
  08F8  23            	 inc HL
  08F9  34            	 inc (HL)
  08FA  1820          	 jr gil_walk
                      	
  08FC                	gil_up:
  08FC  3A6C47        	 ld A,(gil_xy);x
  08FF  D61E          	 sub 30
  0901  CA0B09        	 jp z,gil_up_l
  0904                	gil_up_s:
  0904  D607          	 sub 7
  0906  DA3F09        	 jp c,direction_p
  0909  20F9          	 jr nz,gil_up_s
  090B                	gil_up_l:
  090B  3E3F          	 ld A,00111111b
  090D  216D47        	 ld HL,gil_xy+1
  0910  A6            	 and (HL)
  0911  77            	 ld (HL),A
  0912  2B            	 dec HL;ld HL,gil_xy
  0913  CDF90B        	 call wall_ck
  0916  B7            	 or A;
  0917  C22309        	 jp nz,gil_action_end-3
                      	
                      	; ld HL,gil_xy
  091A  23            	 inc HL
  091B  35            	 dec (HL)
                      	; jr gil_walk
                      	
                      	
  091C                	gil_walk:
  091C  216247        	 ld HL,gil_st1
  091F  3EFF          	 ld A,0ffh
  0921  AE            	 xor (HL)
  0922  77            	 ld (HL),A
                      	
  0923  215715        	 ld HL,graph_gil_ulf
  0926                	gil_action_end:
  0926  3A6247        	 ld A,(gil_st1)
  0929  3C            	 inc A
  092A  111800        	 ld DE,24
  092D  CD390A        	 call xsan
  0930                	gil_action_end_l:
  0930  3A6C47        	 ld A,(gil_xy)
  0933  5F            	 ld E,A
  0934  3A6D47        	 ld A,(gil_xy+1)
  0937  57            	 ld D,A
  0938  CDAE0E        	 call grp_set
  093B  E1            	 pop HL
  093C  C3E409        	 jp mains_end
                      	
  093F                	direction_p:
  093F  3A6D47        	 ld A,(gil_xy+1)
  0942  E6C0          	 and 11000000b
  0944  CA0B09        	 jp z,gil_up_l
  0947  FE80          	 cp 80h
  0949  DAC408        	 jp c,gil_right_l
  094C  CAE708        	 jp z,gil_down_l
  094F  C39308        	 jp gil_left
                      	
  0952                	gil_sword_f:;key_action
  0952  08            	 ex AF,AF'
  0953  B7            	 or A
  0954  C26A09        	 jp nz,gil_sword_set 
                      	;************************sword atack***************************
  0957  3E0A          	 ld A,10		;back flame
  0959  326347        	 ld (gil_st2),A
                      	;***********************matk action****************************
  095C  CDAF0C        	 call matk_action_gil
                      	;*************************************************************
  095F  118715        	 ld DE,graph_gilsw_ulf	;gil_sw
  0962  ED532409      	 ld (gil_action_end-2),DE
  0966  08            	 ex AF,AF'
  0967  C38008        	 jp gil_action_l
  096A                	gil_sword_set:
  096A  11B715        	 ld DE,graph_gilsword_ulf	;gil_swd
  096D  ED532409      	 ld (gil_action_end-2),DE
  0971                	gil_sword_set_l:
  0971  08            	 ex AF,AF'
  0972  C38008        	 jp gil_action_l
  0975                	gil_sword_reset:
  0975  08            	 ex AF,AF'
  0976  3A6347        	 ld A,(gil_st2)
  0979  47            	 ld B,A
  097A  08            	 ex AF,AF'
  097B  CB78          	 bit 7,B
  097D  C8            	 ret z
  097E  08            	 ex AF,AF'
  097F  E1            	 pop HL
  0980  3E80          	 ld A,10000000b
                      	;************************sword back***************************
  0982  F60A          	 or 10			;back flame
  0984  326347        	 ld (gil_st2),A
  0987  08            	 ex AF,AF'
  0988  C38008        	 jp gil_action_l
  098B                	gil_sword_f2:;auto_action
  098B  FE80          	 cp 80h
  098D  CA7108        	 jp z,gil_action_l_b
  0990  E680          	 and 10000000b
  0992  C2AA09        	 jp nz,gil_sword_f_decB;A=1nnnnnnnb
  0995                	gil_sword_f_decA:;A=0nnnnnnnb
  0995  216347        	 ld HL,gil_st2
  0998  7E            	 ld A,(HL)
  0999  3D            	 dec A
  099A  77            	 ld (HL),A
  099B  118715        	 ld DE,graph_gilsw_ulf	;gil_sw
  099E  ED532409      	 ld (gil_action_end-2),DE
  09A2  C2BE09        	 jp nz,gil_action_l_r
  09A5  CBFE          	 set 7,(HL)
  09A7  C3BE09        	 jp gil_action_l_r
  09AA                	gil_sword_f_decB:;A=1nnnnnnnb
  09AA  216347        	 ld HL,gil_st2
  09AD  7E            	 ld A,(HL)
  09AE  3D            	 dec A
  09AF  77            	 ld (HL),A
  09B0  E67F          	 and 01111111b
  09B2  118715        	 ld DE,graph_gilsw_ulf	;gil_sw
  09B5  ED532409      	 ld (gil_action_end-2),DE
  09B9  C2BE09        	 jp nz,gil_action_l_r
  09BC  CBBE          	 res 7,(HL)
  09BE                	gil_action_l_r:
  09BE  08            	 ex AF,AF'
  09BF  C38008        	 jp gil_action_l
                      	
                      	
  09C2                	gil_killing:
  09C2  CDBF0A        	 call grp_o
  09C5  21D909        	 ld HL,killingm
  09C8  110000        	 ld DE,0
  09CB  060B          	 ld B,11
  09CD  CDF1BF        	 call msp
  09D0  DD7ED0        	 ld A,(IX-48)
  09D3  32F000        	 ld (0f0h),A
  09D6  C3FC09        	 jp retP
                      	
                      	
                      	
  09D9                	killingm:
  09D9  6265656E206B69	 db "been killed"
                      	
                      	
  09E4                	mains_end:
                      	; ld A,(IX+48)
                      	; ld (0f0h),A
                      	; ld (0f2h),IX
                      	
  09E4  3A7303        	 ld A,(count+1)
  09E7  3D            	 dec A
  09E8  327303        	 ld (count+1),A
  09EB  23            	 inc HL
  09EC  23            	 inc HL
  09ED  DD23          	 inc IX
  09EF  FD23          	 inc IY
  09F1  D9            	 exx
  09F2  CDE50A        	 call keysc
  09F5  CB57          	 bit 2,A
  09F7  C0            	 ret nz
  09F8  D9            	 exx
  09F9  C37203        	 jp mains
                      	
                      	
  09FC                	retP:
  09FC  310000        	 ld SP,0
  09FF  C9            	 ret
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	;*********************************************************
  0A00                	TIMBTL:
  0A00  3E32          	 LD A,50
  0A02  1806          	 JR TIMER
  0A04                	TIM30:
  0A04  3E25          	 LD A,37
  0A06  1802          	 JR TIMER
  0A08                	TIM255:
  0A08  3EFF          	 LD A,255
  0A0A                	TIMER:
  0A0A  010000        	 LD BC,0
  0A0D  03            	 INC BC;LOOP
  0A0E  000000000000  	 DB 0,0,0,0,0,0
  0A14  A8            	 XOR B
  0A15  C8            	 RET Z
  0A16  18F5          	 JR TIMER+3
  0A18                	RAND:;A
  0A18  E5            	 PUSH HL
  0A19  D5            	 push DE
  0A1A  210000        	 LD HL,0
  0A1D  54            	 LD D,H
  0A1E  5D            	 LD E,L
  0A1F  29            	 ADD HL,HL
  0A20  29            	 ADD HL,HL
  0A21  19            	 ADD HL,DE
  0A22  11475D        	 LD DE,5D47H
  0A25  19            	 ADD HL,DE
  0A26  221B0A        	 LD (RAND+3),HL
  0A29  7C            	 LD A,H
  0A2A  D1            	 pop DE
  0A2B  E1            	 POP HL
  0A2C  C9            	 RET
  0A2D                	RAND4:
  0A2D  ED5F          	 ld A,R
  0A2F  1F            	 rra
  0A30  1F            	 rra
  0A31  1F            	 rra
  0A32  C9            	 ret
  0A33  CD180A        	 CALL RAND
  0A36  E603          	 AND 3
  0A38  C9            	 RET
  0A39                	XSAN:
  0A39  B7            	 OR A
  0A3A  C8            	 RET Z
  0A3B                	XSANL:
  0A3B  19            	 ADD HL,DE
  0A3C  3D            	 DEC A
  0A3D  20FC          	 JR NZ,XSANL
  0A3F  C9            	 RET
  0A40                	NMEMRY:
  0A40  0000000000    	 DB 0,0,0,0,0
  0A45                	ASCN:;HL=l(2byte)DE
  0A45  11400A        	 LD DE,NMEMRY
  0A48  011027        	 LD BC,10000
  0A4B  CD7F0A        	 CALL WARIS
  0A4E  01E803        	 LD BC,1000
  0A51  CD7F0A        	 CALL WARIS
  0A54  016400        	 LD BC,100
  0A57  CD7F0A        	 CALL WARIS
  0A5A  010A00        	 LD BC,10
  0A5D  CD7F0A        	 CALL WARIS
  0A60  7D            	 LD A,L
  0A61  12            	 LD (DE),A
  0A62  0605          	 LD B,5
  0A64  11400A        	 LD DE,NMEMRY
  0A67                	ASCL:
  0A67  1A            	 LD A,(DE)
  0A68  FE00          	 CP 0
  0A6A  2802          	 JR Z,ASCL2
  0A6C  1808          	 JR ASC2
  0A6E                	ASCL2:
  0A6E  13            	 INC DE
  0A6F  10F6          	 DJNZ ASCL
  0A71  0601          	 LD B,1
  0A73  11440A        	 LD DE,NMEMRY+4
  0A76                	ASC2:
  0A76  1A            	 LD A,(DE)
  0A77  0E30          	 LD C,30H
  0A79  81            	 ADD A,C
  0A7A  12            	 LD (DE),A
  0A7B  13            	 INC DE
  0A7C  10F8          	 DJNZ ASC2
  0A7E  C9            	 RET
  0A7F                	WARIS:
  0A7F  AF            	 XOR A
                      	;WARI1:
  0A80  ED42          	 SBC HL,BC
  0A82  3803          	 JR C,WARI2
  0A84  3C            	 INC A
  0A85  18F9          	 JR WARIS+1
  0A87                	WARI2:
  0A87  09            	 ADD HL,BC
  0A88  12            	 LD (DE),A
  0A89  13            	 INC DE		;
  0A8A  C9            	 RET
  0A8B                	cls:
  0A8B  F5            	 push AF
  0A8C  D5            	 push DE
  0A8D  E5            	 push HL
  0A8E  C5            	 push BC
  0A8F  3E00          	 ld A,0
  0A91  213B10        	 ld HL,grapu_area
  0A94  113C10        	 ld DE,grapu_area+1
  0A97  77            	 ld (HL),A
  0A98  015F03        	 ld BC,144*6-1
  0A9B  EDB0          	 ldir
  0A9D  CDBF0A        	 call grp_o
  0AA0  C1            	 pop BC
  0AA1  E1            	 pop HL
  0AA2  D1            	 pop DE
  0AA3  F1            	 pop AF
  0AA4  C9            	 ret
                      	
  0AA5                	bls:
  0AA5  F5            	 push AF
  0AA6  D5            	 push DE
  0AA7  E5            	 push HL
  0AA8  C5            	 push BC
  0AA9  213B10        	 LD HL,grapu_area
  0AAC  36FF          	 LD (HL),0FFH
  0AAE  113C10        	 LD DE,grapu_area+1
  0AB1  015F03        	 LD BC,863
  0AB4  EDB0          	 LDIR
  0AB6  CDBF0A        	 CALL grp_o
  0AB9  D9            	 EXX
  0ABA  C1            	 pop BC
  0ABB  E1            	 pop HL
  0ABC  D1            	 pop DE
  0ABD  F1            	 pop AF
  0ABE  C9            	 RET
  0ABF                	grp_o:
  0ABF  3E06          	 ld A,6
  0AC1  110000        	 ld DE,0
  0AC4  213B10        	 ld HL,grapu_area
  0AC7                	grp_o_l:
  0AC7  D5            	 push DE
  0AC8  F5            	 push AF
  0AC9  0690          	 ld B,144
  0ACB  CDD0BF        	 call grp
  0ACE  23            	 inc HL
  0ACF  F1            	 pop AF
  0AD0  D1            	 pop DE
  0AD1  14            	 inc D
  0AD2  3D            	 dec A
  0AD3  20F2          	 jr nz,grp_o_l
  0AD5  C9            	 ret
                      	
  0AD6                	grp_open:
  0AD6  0E06          	 ld C,6
  0AD8                	grp_open_l
  0AD8  C5            	 push BC
  0AD9  D5            	 push DE
  0ADA  CDD0BF        	 call grp
  0ADD  D1            	 pop DE
  0ADE  14            	 inc D
  0ADF  23            	 inc HL
  0AE0  C1            	 pop BC
  0AE1  0D            	 dec C
  0AE2  20F4          	 jr nz,grp_open_l
  0AE4  C9            	 ret
                      	
  0AE5                	keysc:
  0AE5  F3            	 di
  0AE6  AF            	 xor A
  0AE7  D311          	 out (11h),A
  0AE9  3E08          	 ld A,08h
  0AEB  D311          	 out (11h),A
  0AED  CDAD8A        	 call 8aadh
  0AF0  DB10          	 in A,(10h)
  0AF2  E6E0          	 and 0e0h
  0AF4  47            	 ld B,A
  0AF5  AF            	 xor A
  0AF6  D311          	 out (11h),A
  0AF8  3E10          	 ld A,10h
  0AFA  D311          	 out (11h),A
  0AFC  CDAD8A        	 call 8aadh
  0AFF  DB10          	 in A,(10h)
  0B01  E60F          	 and 0fh
  0B03  B0            	 or B
  0B04  FB            	 ei
  0B05  C9            	 ret
                      	
                      	
                      	
  0B06                	charReput:;HL=obj_xy++
  0B06                	charReput_x:
  0B06  7E            	 ld A,(HL);x
  0B07  4F            	 ld C,A
  0B08  D61E          	 sub 30
  0B0A  CA220B        	 jp z,charReput_y
  0B0D                	charReput_x_lp:
  0B0D  D607          	 sub 7
  0B0F  CA220B        	 jp z,charReput_y
  0B12  30F9          	 jr nc,charReput_x_lp
  0B14  FEFD          	 cp 0fch+1;cy=-4~-6 left
  0B16  3804          	 jr c,charReput_x_1
  0B18  ED44          	 neg;(right+)
  0B1A  1804          	 jr charReput_x_2
  0B1C                	charReput_x_1:
  0B1C  C607          	 add A,7
  0B1E  ED44          	 neg;(left-)
  0B20                	charReput_x_2:
  0B20  81            	 add A,C
  0B21  77            	 ld (HL),A
                      	
  0B22                	charReput_y:
  0B22  23            	 inc HL
  0B23  7E            	 ld A,(HL)
  0B24  2B            	 dec HL
  0B25  4F            	 ld C,A
  0B26  E63F          	 and 00111111b
  0B28  C8            	 ret z
  0B29                	charReput_y_lp:
  0B29  D607          	 sub 7
  0B2B  C8            	 ret z
  0B2C  30FB          	 jr nc,charReput_y_lp
  0B2E  FEFD          	 cp 0fch+1;cy=-4~-6 up
  0B30  3804          	 jr c,charReput_y_1
  0B32  ED44          	 neg;(down+)
  0B34  1804          	 jr charReput_y_2
  0B36                	charReput_y_1:
  0B36  C607          	 add A,7
  0B38  ED44          	 neg;(up-)
  0B3A                	charReput_y_2:
  0B3A  81            	 add A,C
  0B3B  23            	 inc HL
  0B3C  77            	 ld (HL),A
  0B3D  2B            	 dec HL
  0B3E  C9            	 ret 
                      	
                      	
  0B3F                	cross_ck_s:;HL=obj_xy+
  0B3F  5E            	 ld E,(HL)
  0B40  23            	 inc HL
  0B41  56            	 ld D,(HL)
  0B42  2B            	 dec HL
  0B43  3A6D47        	 ld A,(gil_xy+1)
  0B46  E6C0          	 and 11000000b
  0B48  CA710B        	 jp z,cross_ck_s_up
  0B4B  FE80          	 cp 80h
  0B4D  DA8F0B        	 jp c,cross_ck_s_right
  0B50  CAAC0B        	 jp z,cross_ck_s_down
  0B53                	cross_ck_s_left:
  0B53  3A6D47        	 ld A,(gil_xy+1)
  0B56  E63F          	 and 3fh
  0B58  92            	 sub D	;x-x1
  0B59  FE03          	 cp 3
  0B5B  3805          	 jr c,cross_ck_s_left_2
  0B5D  2F            	 cpl
  0B5E  3C            	 inc A
  0B5F  FE03          	 cp 3
  0B61  D0            	 ret nc
  0B62                	cross_ck_s_left_2:
  0B62  3A6C47        	 ld A,(gil_xy)
  0B65  93            	 sub E
  0B66  FE06          	 cp 6		;when (a-d)>0 is that empty at left.
  0B68  D8            	 ret c
  0B69  2F            	 cpl
  0B6A  3C            	 inc A
  0B6B  FE03          	 cp 3
  0B6D  DAC209        	 jp c,gil_killing
  0B70  C9            	 ret
  0B71                	cross_ck_s_up:
  0B71  3A6C47        	 ld A,(gil_xy)
  0B74  93            	 sub E	;x-x1
  0B75  FE03          	 cp 3
  0B77  3805          	 jr c,cross_ck_s_up_2
  0B79  2F            	 cpl
  0B7A  3C            	 inc A
  0B7B  FE03          	 cp 3
  0B7D  D0            	 ret nc
  0B7E                	cross_ck_s_up_2:
  0B7E  3A6D47        	 ld A,(gil_xy+1)
  0B81  E63F          	 and 3fh
  0B83  92            	 sub D
  0B84  FE03          	 cp 3		;when (a-d)>0 is that empty at up.
  0B86  D8            	 ret c
  0B87  2F            	 cpl
  0B88  3C            	 inc A
  0B89  FE03          	 cp 3
  0B8B  DAC209        	 jp c,gil_killing
  0B8E  C9            	 ret
  0B8F                	cross_ck_s_right:
  0B8F  3A6D47        	 ld A,(gil_xy+1)
  0B92  E63F          	 and 3fh
  0B94  92            	 sub D	;x-x1
  0B95  FE03          	 cp 3
  0B97  3805          	 jr c,cross_ck_s_right_2
  0B99  2F            	 cpl
  0B9A  3C            	 inc A
  0B9B  FE03          	 cp 3
  0B9D  C9            	 ret ;c or nc
  0B9E                	cross_ck_s_right_2:
  0B9E  3A6C47        	 ld A,(gil_xy)
  0BA1  93            	 sub E
  0BA2  FE03          	 cp 3		;when (a-d)<0 is that empty at right.
  0BA4  DAC209        	 jp c,gil_killing
  0BA7  2F            	 cpl
  0BA8  3C            	 inc A
  0BA9  FE06          	 cp 6
  0BAB  C9            	 ret ;c or nc
  0BAC                	cross_ck_s_down:
  0BAC  3A6C47        	 ld A,(gil_xy)
  0BAF  93            	 sub E	;x-x1
  0BB0  FE03          	 cp 3
  0BB2  3805          	 jr c,cross_ck_s_down_2
  0BB4  2F            	 cpl
  0BB5  3C            	 inc A
  0BB6  FE03          	 cp 3
  0BB8  D0            	 ret nc
  0BB9                	cross_ck_s_down_2:
  0BB9  3A6D47        	 ld A,(gil_xy+1)
  0BBC  E63F          	 and 3fh
  0BBE  92            	 sub D
  0BBF  FE03          	 cp 3		;when (a-d)<0 is that empty at down.
  0BC1  DAC209        	 jp c,gil_killing
  0BC4  D8            	 ret c
  0BC5  2F            	 cpl
  0BC6  3C            	 inc A
  0BC7  FE06          	 cp 6
  0BC9  C9            	 ret
                      	
                      	
  0BCA                	cross_ck_a:;HL=obj_xy+
  0BCA  5E            	 ld E,(HL);x
  0BCB  23            	 inc HL
  0BCC  7E            	 ld A,(HL)
  0BCD  2B            	 dec HL
  0BCE  E63F          	 and 3fh
  0BD0  57            	 ld D,A	;y
                      	; ld HL,(gil_xy)
  0BD1  3A6C47        	 ld A,(gil_xy)
  0BD4  93            	 sub E	;x-x1
  0BD5  FE03          	 cp 3
  0BD7  3805          	 jr c,cross_ck_al
  0BD9  2F            	 cpl
  0BDA  3C            	 inc A
  0BDB  FE03          	 cp 3
  0BDD  D0            	 ret nc
  0BDE                	cross_ck_al:
  0BDE  3A6D47        	 ld A,(gil_xy+1)
  0BE1  E63F          	 and 3fh
  0BE3  92            	 sub D
  0BE4  FE03          	 cp 3
  0BE6  D8            	 ret c
  0BE7  2F            	 cpl
  0BE8  3C            	 inc A
  0BE9  FE03          	 cp 3
  0BEB  C9            	 ret ;nc or cy
                      	;cy is crosses.
                      	
  0BEC                	cha_kill:;HL=obj_xy++,IX=obj_hp
  0BEC  E5            	 push HL
  0BED  5E            	 ld E,(HL)
  0BEE  23            	 inc HL
  0BEF  56            	 ld D,(HL)
  0BF0  CD3A0F        	 call grp_del
  0BF3  E1            	 pop HL
  0BF4  AF            	 xor A
  0BF5  DD7700        	 ld (IX),A
  0BF8  C9            	 ret
                      	
                      	
  0BF9                	wall_ck:
  0BF9  E5            	 push HL
  0BFA  CDFF0B        	 call wall_cks
  0BFD  E1            	 pop HL
  0BFE  C9            	 ret
                      	
  0BFF                	wall_cks:;HL,obj_xy+;non zero=don't pass, zero=pass and A=0, cy=not block
  0BFF  E5            	 push HL
                      	;HL=(y,x)
  0C00  5E            	 ld E,(HL);x
  0C01  23            	 inc HL
  0C02  56            	 ld D,(HL);y
  0C03  2B            	 dec HL
  0C04  EB            	 ex DE,HL
  0C05  3E3F          	 ld A,00111111b
  0C07  A4            	 and H
  0C08  010000        	 ld BC,0
  0C0B  2808          	 jr z,wall_ck_lc
  0C0D                	wall_ck_lb:
  0C0D  04            	 inc B
  0C0E  D607          	 sub 7
  0C10  DA890C        	 jp c,wall_ck_end
  0C13  20F8          	 jr nz,wall_ck_lb
  0C15                	wall_ck_lc:
  0C15  7D            	 ld A,L
  0C16  D61E          	 sub 30
  0C18  2808          	 jr z,wall_ck_le
  0C1A                	wall_ck_ld:
  0C1A  0C            	 inc C
  0C1B  D607          	 sub 7
  0C1D  DA890C        	 jp c,wall_ck_end
  0C20  20F8          	 jr nz,wall_ck_ld
  0C22                	wall_ck_le:
  0C22  7C            	 ld A,H
  0C23  E6C0          	 and 11000000b
  0C25  CA730C        	 jp z,wall_ck_lu
  0C28  FE80          	 cp 80h
  0C2A  DA5C0C        	 jp c,wall_ck_lr
  0C2D  CA460C        	 jp z,wall_ck_ldd
                      	
  0C30                	wall_ck_ll:
  0C30  21090E        	 ld HL,map_memry_left-17
                      	;x+C
  0C33  59            	 ld E,C
  0C34  1600          	 ld D,0
  0C36  19            	 add HL,DE
                      	;y+17*B
  0C37  111100        	 ld DE,17
  0C3A  04            	 inc B
  0C3B                	wall_ck_ll_2:
  0C3B  19            	 add HL,DE
  0C3C  10FD          	 djnz wall_ck_ll_2
                      	; or A
                      	; sbc HL,DE
  0C3E  22CC0C        	 ld (block_pointaP+1),HL
  0C41  7E            	 ld A,(HL)
  0C42  E680          	 and t;t(80h) or f(0)
  0C44  E1            	 pop HL
                      	
                      	; ld A,"l"
                      	; ld DE,0
                      	; call 0be62h
                      	; pop HL
                      	
  0C45  C9            	 ret
                      	
                      	
  0C46                	wall_ck_ldd:
  0C46  218A0D        	 ld HL,map_memry_top-16
                      	;x+C
  0C49  59            	 ld E,C
  0C4A  1600          	 ld D,0
  0C4C  19            	 add HL,DE
                      	;y+16*B
  0C4D  111000        	 ld DE,16
  0C50  04            	 inc B
  0C51                	wall_ck_ld2:
  0C51  19            	 add HL,DE
  0C52  10FD          	 djnz wall_ck_ld2
                      	; sub HL,DE
  0C54  22CC0C        	 ld (block_pointaP+1),HL
  0C57  7E            	 ld A,(HL)
  0C58  E680          	 and t;t(80h) or f(0)
  0C5A  E1            	 pop HL
                      	
                      	; ld A,"d"
                      	; ld DE,0
                      	; call 0be62h
                      	; pop HL
                      	
  0C5B  C9            	 ret
                      	
                      	
  0C5C                	wall_ck_lr:
  0C5C  21090E        	 ld HL,map_memry_left-17
                      	;x+C
  0C5F  59            	 ld E,C
  0C60  1600          	 ld D,0
  0C62  19            	 add HL,DE
  0C63  23            	 inc HL
                      	;y+17*B
  0C64  111100        	 ld DE,17
  0C67  04            	 inc B
  0C68                	wall_ck_lr_2:
  0C68  19            	 add HL,DE
  0C69  10FD          	 djnz wall_ck_lr_2
                      	; or A
                      	; sbc HL,DE
  0C6B  22CC0C        	 ld (block_pointaP+1),HL
  0C6E  7E            	 ld A,(HL)
  0C6F  E680          	 and t;t(80h) or f(0)
  0C71  E1            	 pop HL
                      	
                      	; ld A,"r"
                      	; ld DE,0
                      	; call 0be62h
                      	; pop HL
                      	
  0C72  C9            	 ret
                      	
                      	
                      	
                      	
  0C73                	wall_ck_lu:
  0C73  217A0D        	 ld HL,map_memry_top-16-16
                      	;x+C
  0C76  59            	 ld E,C
  0C77  1600          	 ld D,0
  0C79  19            	 add HL,DE
                      	;y+16*B
  0C7A  111000        	 ld DE,16
  0C7D  04            	 inc B
  0C7E                	wall_ck_lu2:
  0C7E  19            	 add HL,DE
  0C7F  10FD          	 djnz wall_ck_lu2
                      	; or A
                      	; sbc HL,DE
  0C81  22CC0C        	 ld (block_pointaP+1),HL
  0C84  7E            	 ld A,(HL)
  0C85  E680          	 and t;t(80h) or f(0)
  0C87  E1            	 pop HL
                      	
                      	; ld A,"u"
                      	; ld DE,0
                      	; call 0be62h
                      	; pop HL
                      	
  0C88  C9            	 ret
  0C89                	wall_ck_end:
  0C89  E1            	 pop HL
  0C8A  AF            	 xor A
  0C8B  C9            	 ret
                      	
                      	
                      	;******************************wall mod block**************************
                      	;********************wall mod****HL=obj_xy************************
  0C8C                	wall_mod:
  0C8C  010000        	 ld BC,0
  0C8F  7E            	 ld A,(HL) 
  0C90  5F            	 ld E,A
  0C91  23            	 inc HL
  0C92  7E            	 ld A,(HL)
  0C93  E63F          	 and 00111111b
  0C95  57            	 ld D,A
  0C96  2B            	 dec HL
                      	 
  0C97  7B            	 ld A,E
  0C98  D61E          	 sub 30
  0C9A  2807          	 jr z,wall_mod_l2
  0C9C                	wall_mod_l1:
  0C9C  D607          	 sub 7
  0C9E  2803          	 jr z,wall_mod_l2
  0CA0  30FA          	 jr nc,wall_mod_l1
  0CA2  4F            	 ld C,A
                      	
  0CA3                	wall_mod_l2
  0CA3  7A            	 ld A,D
  0CA4  B7            	 or A
  0CA5  2807          	 jr z,wall_mod_l4
  0CA7                	wall_mod_l3:
  0CA7  D607          	 sub 7
  0CA9  2803          	 jr z,wall_mod_l4
  0CAB  30FA          	 jr nc,wall_mod_l3
  0CAD  47            	 ld B,A
  0CAE                	wall_mod_l4
                      	; ld A,E
                      	; ld (0f0h),A
                      	; ld A,D
                      	; ld (0f1h),A
                      	; ld A,C
                      	; ld (0f4h),A
                      	; ld A,B
                      	; ld (0f5h),A
  0CAE  C9            	 ret
                      	 
                      	 
                      	 
                      	;*************************************matk action******************************
                      	
  0CAF                	matk_action_gil:
  0CAF  216547        	 ld HL,gil_matk_count
  0CB2  5E            	 ld E,(HL)
  0CB3  1C            	 inc E
  0CB4  1D            	 dec E
  0CB5  C8            	 ret z
  0CB6  1D            	 dec E
  0CB7  73            	 ld (HL),E
                      	
  0CB8  216C47        	 ld HL,gil_xy
  0CBB                	matk_action:;HL=obj address+ let push pop
  0CBB  08            	 ex AF,AF'
  0CBC  320D0D        	 ld (matk_action_gil_ret+1),A
  0CBF  22D60C        	 ld (matk_action_HLP+1),HL
  0CC2  CDF90B        	 call wall_ck
  0CC5  DA0C0D        	 jp c,matk_action_gil_ret
  0CC8  CA0C0D        	 jp z,matk_action_gil_ret
  0CCB                	block_pointaP:
  0CCB  210000        	 ld HL,overwrite		;block address
  0CCE  4E            	 ld C,(HL)
  0CCF  0C            	 inc C
  0CD0  CA010D        	 jp z,gil_matk_break 
  0CD3  3600          	 ld (HL),0
                      	 
                      	; call bls
                      	
  0CD5                	matk_action_HLP:
  0CD5  210000        	 ld HL,overwrite
  0CD8  220F0D        	 ld (matk_action_gil_ret+3),HL
                      	
  0CDB  5E            	 ld E,(HL)
  0CDC  23            	 inc HL
  0CDD  56            	 ld D,(HL)
  0CDE  7A            	 ld A,D
  0CDF  E6C0          	 and 11000000b
  0CE1  2818          	 jr z,matk_action_u
  0CE3  FE80          	 cp 80h
  0CE5  380E          	 jr c,matk_action_r
  0CE7  2806          	 jr z,matk_action_d
  0CE9                	matk_action_l:
  0CE9  1D            	 dec E
  0CEA  CD3A0F        	 call grp_del
  0CED  181D          	 jr matk_action_gil_ret
  0CEF                	matk_action_d:
  0CEF  14            	 inc D
  0CF0  CD3A0F        	 call grp_del
  0CF3  1817          	 jr matk_action_gil_ret
  0CF5                	matk_action_r:
  0CF5  1C            	 inc E
  0CF6  CD3A0F        	 call grp_del
  0CF9  1811          	 jr matk_action_gil_ret
  0CFB                	matk_action_u:
  0CFB  15            	 dec D
  0CFC  CD3A0F        	 call grp_del
  0CFF  180B          	 jr matk_action_gil_ret
                      	
  0D01                	gil_matk_break:
  0D01  DD7ED0        	 ld A,(IX-48)
  0D04  FE8F          	 cp 8fh
  0D06  2004          	 jr nz,matk_action_gil_ret
  0D08  AF            	 xor A
  0D09  326547        	 ld (gil_matk_count),A
  0D0C                	matk_action_gil_ret:
  0D0C  3E00          	 ld A,overwrite
  0D0E  210000        	 ld HL,overwrite
  0D11  08            	 ex AF,AF'
  0D12  C9            	 ret
                      	
                      	
                      	
  0D13                	Map_make:
  0D13  CD8B0A        	 call cls
  0D16  218716        	 ld HL,Map_data
  0D19  3AD845        	 ld A,(floor)
  0D1C  3D            	 dec A
  0D1D  11C900        	 ld DE,96+105
  0D20  CD390A        	 call xsan
  0D23  119A0D        	 ld DE,map_memry_top
  0D26  016000        	 ld BC,96
  0D29  EDB0          	 ldir
  0D2B  111A0E        	 ld DE,map_memry_left
  0D2E  3E07          	 ld A,7
  0D30  13            	 inc DE
  0D31                	map_make_l:
  0D31  F5            	 push AF
  0D32  010F00        	 ld BC,15
  0D35  EDB0          	 ldir
  0D37  13            	 inc DE
  0D38  13            	 inc DE
  0D39  F1            	 pop AF
  0D3A  3D            	 dec A
  0D3B  20F4          	 jr nz,map_make_l
  0D3D  111E06        	 ld DE,061eh
  0D40  DD219A0D      	 ld IX,map_memry_top
  0D44  FD211A0E      	 ld IY,map_memry_left
                      	
  0D48                	map_make_l_l:
  0D48  DD7E00        	 ld A,(IX)
  0D4B  E680          	 and t
  0D4D  2808          	 jr z,map_make_Xe
  0D4F  D5            	 push DE
  0D50  21A20E        	 ld HL,graph_wall+0
  0D53  CDAE0E        	 call grp_set
  0D56  D1            	 pop DE
  0D57                	map_make_Xe:
  0D57  DD23          	 inc IX
                      	
  0D59  FD7E00        	 ld A,(IY)
  0D5C  E680          	 and t
  0D5E  280F          	 jr z,map_make_Ye
  0D60  D5            	 push DE
  0D61  21A80E        	 ld HL,graph_wall+6
  0D64  15            	 dec D
  0D65  15            	 dec D
  0D66  15            	 dec D
  0D67  15            	 dec D
  0D68  15            	 dec D
  0D69  15            	 dec D
  0D6A  1D            	 dec E
  0D6B  CDAE0E        	 call grp_set
  0D6E  D1            	 pop DE
  0D6F                	map_make_Ye:
  0D6F  FD23          	 inc IY
                      	
  0D71  3E07          	 ld A,7
  0D73  83            	 add A,E
  0D74  5F            	 ld E,A
  0D75  FE8E          	 cp 142
  0D77  C2480D        	 jp nz,map_make_l_l
                      	 
  0D7A  3E07          	 ld A,7
  0D7C  82            	 add A,D
  0D7D  57            	 ld D,A
  0D7E  FE37          	 cp 55
  0D80  2807          	 jr z,map_make_end
  0D82  1E1E          	 ld E,1eh
  0D84  FD23          	 inc IY
  0D86  C3480D        	 jp map_make_l_l
  0D89                	map_make_end:
  0D89  C9            	 ret
                      	
                      	
                      	
                      	
  0D8A  FFFFFFFFFFFFFF	 db 0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh;16
  0D9A                	map_memry_top:;1(ture or false)0000000(loop count,7fh=Outer wall)b
  0D9A                	 ds 16
  0DAA                	 ds 16
  0DBA                	 ds 16
  0DCA                	 ds 16
  0DDA                	 ds 16
  0DEA                	 ds 16
  0DFA  FFFFFFFFFFFFFF	 db 0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh;16
  0E0A  FFFFFFFFFFFFFF	 db 0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh;16
                      	
                      	
                      	
  0E1A                	map_memry_left:;1(ture or false)0000000(loop count,7fh=Outer wall)b
  0E1A  FF            	 db 0ffh
  0E1B                	 ds 15
  0E2A  FF            	 db 0ffh
  0E2B  FF            	 db 0ffh
  0E2C                	 ds 15
  0E3B  FF            	 db 0ffh
  0E3C  FF            	 db 0ffh
  0E3D                	 ds 15
  0E4C  FF            	 db 0ffh
  0E4D  FF            	 db 0ffh
  0E4E                	 ds 15
  0E5D  FF            	 db 0ffh
  0E5E  FF            	 db 0ffh
  0E5F                	 ds 15
  0E6E  FF            	 db 0ffh
  0E6F  FF            	 db 0ffh
  0E70                	 ds 15
  0E7F  FF            	 db 0ffh
  0E80  FF            	 db 0ffh
  0E81                	 ds 15
  0E90  FF            	 db 0ffh
  0E91  FF            	 db 0ffh
                      	 
  0E92                	 ds 15
  0EA1  FF            	 db 0ffh
  0EA2                	graph_wall:
  0EA2  010101010101  	 db 1,1,1,1,1,1
  0EA8  3F0000000000  	 db 3fh,0,0,0,0,0
                      	
                      	
                      	
  0EAE                	grp_set:;HL_data,DE_(y,x),B_databit
  0EAE  0606          	 ld B,6
                      	;
                      	
  0EB0  7A            	 ld A,D
  0EB1  E6C0          	 and 11000000b
  0EB3  281F          	 jr z,grp_set_0
  0EB5  FE80          	 cp 80h
  0EB7  3814          	 jr c,grp_set_1
  0EB9  2809          	 jr z,grp_set_2
                      	;left
  0EBB  3E12          	 ld A,18
  0EBD  85            	 add A,L
  0EBE  6F            	 ld L,A
  0EBF  3013          	 jr nc,grp_set_0
  0EC1  24            	 inc H
  0EC2  1810          	 jr grp_set_0
                      	;dowm
  0EC4                	grp_set_2:
  0EC4  3E0C          	 ld A,12
  0EC6  85            	 add A,L
  0EC7  6F            	 ld L,A
  0EC8  300A          	 jr nc,grp_set_0
  0ECA  24            	 inc H
  0ECB  1807          	 jr grp_set_0
                      	;right
  0ECD                	grp_set_1:
  0ECD  3E06          	 ld A,6
  0ECF  85            	 add A,L
  0ED0  6F            	 ld L,A
  0ED1  3001          	 jr nc,grp_set_0
  0ED3  24            	 inc H
                      	
                      	;up,non direction
  0ED4                	grp_set_0:
  0ED4  7B            	 ld A,E
  0ED5  32FB0E        	 ld (grp_set_or1+1),A
  0ED8  7A            	 ld A,D
  0ED9  E63F          	 and 3fh
  0EDB  1600          	 ld D,0
  0EDD                	grp_set_set1:
  0EDD  14            	 inc D
  0EDE  D608          	 sub 8
  0EE0  30FB          	 jr nc,grp_set_set1
  0EE2  15            	 dec D
  0EE3  C608          	 add A,8
  0EE5                	grp_set_set2:
  0EE5  32040F        	 ld (grp_set_shiftd_bit+1),A
  0EE8  4F            	 ld C,A
  0EE9  3E08          	 ld A,8
  0EEB  91            	 sub C
  0EEC  322A0F        	 ld (grp_set_shiftu_bit+1),A
                      	
  0EEF                	grp_set_shiftd:
  0EEF  7A            	 ld A,D			;line number
  0EF0  E5            	 push HL					;HL
  0EF1  213B10        	 ld HL,grapu_area
  0EF4  119000        	 ld DE,144
  0EF7  CD390A        	 call xsan		;y+
  0EFA                	grp_set_or1:
  0EFA  1E00          	 ld E,overwrite
  0EFC  1600          	 ld D,0
  0EFE  19            	 add HL,DE		;x+
  0EFF  EB            	 ex DE,HL
  0F00  E1            	 pop HL			;data
  0F01  E5            	 push HL					;HL
  0F02  C5            	 push BC						;BC
  0F03                	grp_set_shiftd_bit:
  0F03  0E00          	 ld C,overwrite		;shift bit count
  0F05  7E            	 ld A,(HL)
  0F06  08            	 ex AF,AF'
  0F07  79            	 ld A,C
  0F08  B7            	 or A
  0F09  2807          	 jr z,grp_set_shiftd_bit_2
  0F0B  08            	 ex AF,AF'
  0F0C                	grp_set_shiftd_bit_l:
  0F0C  CB27          	 sla A
  0F0E  0D            	 dec C
  0F0F  20FB          	 jr nz,grp_set_shiftd_bit_l
  0F11  08            	 ex AF,AF'
  0F12                	grp_set_shiftd_bit_2:
  0F12  08            	 ex AF,AF'
  0F13  4F            	 ld C,A
  0F14  1A            	 ld A,(DE)
  0F15                	grp_set_change1:
  0F15  B1            	 or C
  0F16  12            	 ld (DE),A
  0F17                	grp_set_shiftd_l:
  0F17  23            	 inc HL
  0F18  13            	 inc DE
  0F19  10E8          	 djnz grp_set_shiftd_bit
                      	
                      	; dec DE
                      	
  0F1B  EB            	 ex DE,HL
  0F1C  119000        	 ld DE,144
  0F1F  19            	 add HL,DE
                      	
                      	
  0F20  C1            	 pop BC						;HL
  0F21  7D            	 ld A,L
  0F22  90            	 sub B
  0F23  3001          	 jr nc,grp_set_shiftu_bit_b
  0F25  25            	 dec H
  0F26                	grp_set_shiftu_bit_b:
  0F26  6F            	 ld L,A
  0F27  EB            	 ex DE,HL
                      	
  0F28  E1            	 pop HL			;data2
  0F29                	grp_set_shiftu_bit:
  0F29  0E00          	 ld C,overwrite		;shift bit count
  0F2B  7E            	 ld A,(HL)
  0F2C                	grp_set_shiftu_bit_l
  0F2C  CB3F          	 srl A
  0F2E  0D            	 dec C
  0F2F  20FB          	 jr nz,grp_set_shiftu_bit_l
  0F31  4F            	 ld C,A
  0F32  1A            	 ld A,(DE)
  0F33                	grp_set_change2:
  0F33  B1            	 or C
  0F34  12            	 ld (DE),A
  0F35                	grp_set_shiftu_l:
  0F35  23            	 inc HL
  0F36  13            	 inc DE
  0F37  10F0          	 djnz grp_set_shiftu_bit
                      	
                      	; call grp_o
  0F39  C9            	 ret
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
                      	
  0F3A                	grp_del:;HL_data,DE_(y,x),B_databit
  0F3A  21A50F        	 ld HL,del_graph
  0F3D  0606          	 ld B,6
  0F3F  7B            	 ld A,E
  0F40  32660F        	 ld (grp_set_or1d+1),A
  0F43  7A            	 ld A,D
  0F44  E63F          	 and 3fh
  0F46  1600          	 ld D,0
  0F48                	grp_set_set1d:
  0F48  14            	 inc D
  0F49  D608          	 sub 8
  0F4B  30FB          	 jr nc,grp_set_set1d
  0F4D  15            	 dec D
  0F4E  C608          	 add A,8
  0F50                	grp_set_set2d:
  0F50  326F0F        	 ld (grp_set_shiftd_bitd+1),A
  0F53  4F            	 ld C,A
  0F54  3E08          	 ld A,8
  0F56  91            	 sub C
  0F57  32950F        	 ld (grp_set_shiftu_bitd+1),A
                      	
  0F5A                	grp_set_shiftdd:
  0F5A  7A            	 ld A,D			;line number
  0F5B  E5            	 push HL					;HL
  0F5C  213B10        	 ld HL,grapu_area
  0F5F  119000        	 ld DE,144
  0F62  CD390A        	 call xsan		;y+
  0F65                	grp_set_or1d:
  0F65  1E00          	 ld E,overwrite
  0F67  1600          	 ld D,0
  0F69  19            	 add HL,DE		;x+
  0F6A  EB            	 ex DE,HL
  0F6B  E1            	 pop HL			;data
  0F6C  E5            	 push HL					;HL
  0F6D  C5            	 push BC						;BC
  0F6E                	grp_set_shiftd_bitd:
  0F6E  0E00          	 ld C,overwrite		;shift bit count
  0F70  7E            	 ld A,(HL)
  0F71  08            	 ex AF,AF'
  0F72  79            	 ld A,C
  0F73  B7            	 or A
  0F74  2807          	 jr z,grp_set_shiftd_bit_2d
  0F76  08            	 ex AF,AF'
  0F77                	grp_set_shiftd_bit_ld:
  0F77  37            	 scf
  0F78  17            	 rla
  0F79  0D            	 dec C
  0F7A  20FB          	 jr nz,grp_set_shiftd_bit_ld
  0F7C  08            	 ex AF,AF'
  0F7D                	grp_set_shiftd_bit_2d:
  0F7D  08            	 ex AF,AF'
  0F7E  4F            	 ld C,A
  0F7F  1A            	 ld A,(DE)
  0F80                	grp_set_change1d:
  0F80  A1            	 and C
  0F81  12            	 ld (DE),A
  0F82                	grp_set_shiftd_ld:
  0F82  23            	 inc HL
  0F83  13            	 inc DE
  0F84  10E8          	 djnz grp_set_shiftd_bitd
                      	
                      	; dec DE
                      	
  0F86  EB            	 ex DE,HL
  0F87  119000        	 ld DE,144
  0F8A  19            	 add HL,DE
                      	
                      	
  0F8B  C1            	 pop BC						;HL
  0F8C  7D            	 ld A,L
  0F8D  90            	 sub B
  0F8E  3001          	 jr nc,grp_set_shiftu_bit_bd
  0F90  25            	 dec H
  0F91                	grp_set_shiftu_bit_bd:
  0F91  6F            	 ld L,A
  0F92  EB            	 ex DE,HL
                      	
  0F93  E1            	 pop HL			;data2
  0F94                	grp_set_shiftu_bitd:
  0F94  0E00          	 ld C,overwrite		;shift bit count
  0F96  7E            	 ld A,(HL)
  0F97                	grp_set_shiftu_bit_ld
  0F97  37            	 scf
  0F98  1F            	 rra
  0F99  0D            	 dec C
  0F9A  20FB          	 jr nz,grp_set_shiftu_bit_ld
  0F9C  4F            	 ld C,A
  0F9D  1A            	 ld A,(DE)
  0F9E                	grp_set_change2d:
  0F9E  A1            	 and C
  0F9F  12            	 ld (DE),A
  0FA0                	grp_set_shiftu_ld:
  0FA0  23            	 inc HL
  0FA1  13            	 inc DE
  0FA2  10F0          	 djnz grp_set_shiftu_bitd
  0FA4  C9            	 ret
                      	
  0FA5                	del_graph:
  0FA5  C0C0C0C0C0C0  	 db 0c0h,0c0h,0c0h,0c0h,0c0h,0c0h
                      	
                      	
                      	; ds 144
                      	; ds 144
                      	
  0FAB                	 ds 144
  103B                	grapu_area:
  103B                	 ds 144*6
  139B                	 ds 144
                      	 
                      	; ds 144
                      	; ds 144
                      	;********************************Graphics**********************************
  142B                	graph_title:
  142B  00000000000000	 db 00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,80h,60h,80h,00,00,0C0h,30h,0Ch,08h,30h,0C0h,0C0h,30h,08h,10h,0E0h,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
  145D  00000000000000	 db 00,00,00,00,00,00,00,00,00,80h,0C0h,00,00,80h,60h,10h,18h,06h,01h,00h,01h,0Eh,03h,00,00,00,00,00,00,01,00,00,00,03,0Ch,30h,40h,080h,00,80h,0E0h,00,00,00,00,00,00,00,00,00
  148F  000000000000C0	 db 00,00,00,00,00,00,0C0h,30h,0Eh,01h,4Fh,66h,0F1h,0E0h,0F0h,58h,58h,40h,20h,80h,0E0h,0F8h,80h,0F0h,0C0h,0E0h,0F0h,0D8h,68h,0A9h,0C3h,42h,82h,86h,84h,0Ch,18h,79h,0F6h,0E1h,0C1h,86h,38h,0C0h,00,00,00,00,00,00
  14C1  00804020180601	 db 00,80h,40h,20h,18h,06h,01h,00,00,00,00,0Fh,3Fh,7Fh,0FEh,0F8h,0F8h,0F0h,0FEh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,7Eh,7Eh,7Dh,7Dh,78h,7Dh,3Fh,1Fh,0Fh,00,00,03h,0Ch,70h,80h,00,00
  14F3  00FF0000000000	 db 00,0FFh,00,00,00,00,00,00,00,0F8h,08,08,0F0h,00,0FCh,02Eh,06Fh,0D7h,07,7Fh,80h,00,0F8h,00,0F0h,50h,4Ch,4Eh,0FFh,07,0F7h,0Fh,4Eh,4Ch,0D4h,00,0F0h,50h,48h,48h,0F8h,00,00,00,00,00,00,0Fh,30h,0C0h
  1525  78474040404044	 db 78h,47h,40h,40h,40h,40h,44h,44h,44h,45h,45h,45h,44h,44h,45h,44h,44h,45h,44h,44h,45h,45h,45h,44h,45h,44h,44h,44h,45h,44h,44h,45h,45h,45h,45h,44h,45h,44h,44h,44h,45h,44h,44h,44h,40h,40h,40h,40h,40h,7Fh
                      	
  1557                	graph_gil_ulf:
  1557  000C3F1F0C00  	 db 00,0Ch,3Fh,1Fh,0Ch,00
  155D                	graph_gil_rlf:
  155D  00003F3F0C00  	 db 00,00,3Fh,3Fh,0Ch,00
  1563                	graph_gil_dlf:
  1563  000C1F370C00  	 db 00,0Ch,1Fh,37h,0Ch,00
  1569                	graph_gil_llf:
  1569  000C3F3F0000  	 db 00,0Ch,3Fh,3Fh,00,00
                      	
  156F                	graph_gil_urf:
  156F  000C1F3F0C00  	 db 00,0Ch,1Fh,3Fh,0Ch,00
  1575                	graph_gil_rrf:
  1575  00201F1F2C00  	 db 00,20h,1Fh,1Fh,2Ch,00
  157B                	graph_gil_drf:
  157B  000C3F170C00  	 db 00,0Ch,3Fh,17h,0Ch,00
  1581                	graph_gil_lrf:
  1581  002C1F1F2000  	 db 00,2Ch,1Fh,1Fh,20h,00
                      	
  1587                	graph_gilsw_ulf:
  1587  000C3F1F0C08  	 db 00,0Ch,3Fh,1Fh,0Ch,08
  158D  080C3F3F0C00  	 db 08h,0Ch,3Fh,3Fh,0Ch,00
  1593  080C1F370C00  	 db 08,0Ch,1Fh,37h,0Ch,00
  1599  000C3F3F0C08  	 db 00,0Ch,3Fh,3Fh,0Ch,08
                      	;graph_gilsw_urf:
  159F  000C1F3F0C08  	 db 00,0Ch,1Fh,3Fh,0Ch,08
  15A5  082C1F1F2C00  	 db 08,2Ch,1Fh,1Fh,2Ch,00
  15AB  080C3F170C00  	 db 08,0Ch,3Fh,17h,0Ch,00
  15B1  002C1F1F2C08  	 db 00,2Ch,1Fh,1Fh,2Ch,08
                      	
  15B7                	graph_gilsword_ulf:
  15B7  1E0C3F1F0407  	 db 1Eh,0Ch,3Fh,1Fh,04h,07h
  15BD  000E3F3F0808  	 db 00,0Eh,3Fh,3Fh,08,08
  15C3  38041F3F0C1E  	 db 38h,04h,1Fh,3Fh,0Ch,1Eh
  15C9  08083F3F0E00  	 db 08,08,3Fh,3Fh,0Eh,00
                      	;graph_gilsword_ulf:
  15CF  1E0C1F3F0407  	 db 1Eh,0Ch,1Fh,3Fh,04,07
  15D5  002E1F1F2808  	 db 00,2Eh,1Fh,1Fh,28h,08
  15DB  38043F1F0C1E  	 db 38h,04h,3Fh,1Fh,0Ch,1Eh
  15E1  08281F1F2E00  	 db 08,28h,1Fh,1Fh,2Eh,00
                      	
                      	
  15E7                	graph_sraimd:
  15E7  00181C1C1800  	 db 00,18h,1Ch,1Ch,18h,00
  15ED                	graph_sraimu:
  15ED  00181C1C1800  	 db 00,18h,1Ch,1Ch,18h,00
  15F3                	graph_sraimd1:
  15F3  000C1A1E0C00  	 db 00,0Ch,1Ah,1Eh,0Ch,00
  15F9                	graph_sraimu2:
  15F9  000C1A1E0C00  	 db 00,0Ch,1Ah,1Eh,0Ch,00
                      	
  15FF                	magic:
  15FF  032E3F3F2E03  	 db 03,2Eh,3Fh,3Fh,2Eh,03
  1605                	magicr:
  1605  00203F3F2E18  	 db 00,20h,3Fh,3Fh,2Eh,18h
  160B                	magic3:
  160B  182E3F3F2E18  	 db 18h,2Eh,3Fh,3Fh,2Eh,18h
  1611                	magic4:
  1611  182E3F3F2000  	 db 18h,2Eh,3Fh,3Fh,20h,00
                      	 
  1617                	graph_spell:
  1617  000018180000  	 db 00,00,18h,18h,00,00
  161D  000018180000  	 db 00,00,18h,18h,00,00
  1623  000018180000  	 db 00,00,18h,18h,00,00
  1629  000018180000  	 db 00,00,18h,18h,00,00
                      	 
                      	
  162F                	graph_n_knightu:;r foot
  162F  000C1F3F0407  	 db 00,0Ch,1Fh,3Fh,04,07
  1635                	graph_n_knightr:
  1635  00201F1F2808  	 db 00,20h,1Fh,1Fh,28h,08
  163B                	graph_n_knightd:
  163B  38043F1F0C00  	 db 38h,04h,3Fh,1Fh,0Ch,00
  1641                	graph_n_knightl:
  1641  08281F1F2000  	 db 08,28h,1Fh,1Fh,20h,00
                      	 
                      	;graph_n_knightu:;l foot
  1647  000C3F1F0407  	 db 00,0Ch,3Fh,1Fh,04h,07h
                      	;graph_n_knightr:
  164D  00003F3F0808  	 db 00,00,3Fh,3Fh,08h,08
                      	;graph_n_knightd:
  1653  38041F3F0C00  	 db 38h,04h,1Fh,3Fh,0Ch,00
                      	;graph_n_knightl:
  1659  08083F3F0000  	 db 08,08,3Fh,3Fh,00,00
                      	
                      	
  165F                	dammy:
  165F  000000000000  	 db 0,0,0,0,0,0
  1665  000000000000  	 db 0,0,0,0,0,0
  166B  000000000000  	 db 0,0,0,0,0,0
  1671  000000000000  	 db 0,0,0,0,0,0
                      	;************************************Data**************************************
  1677  2122238F008384	obj_1:db 21h,22h,23h,8fh,0,83h,84h,85h,1,1,1,1,1,0,8fh,0
                      	
                      	
  1687                	Map_data:;96+105=201byte
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t;d
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f;d
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	
  1687  00008080800000	 db f,f,t,t,t,f,f,f,f,f,f,t,f,t,f,f
  1697  00000080008000	 db f,f,f,t,f,t,f,t,f,t,t,f,t,t,f,t
  16A7  80008080000080	 db t,f,t,t,f,f,t,f,f,f,f,f,t,f,f,t
  16B7  00008080808000	 db f,f,t,t,t,t,f,t,f,t,f,f,f,t,f,f
  16C7  00008080808000	 db f,f,t,t,t,t,f,t,t,f,f,t,f,t,f,t
  16D7  80008000008000	 db t,f,t,f,f,t,f,f,t,t,f,t,t,t,f,t
                      	
                      	
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t;d
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	; db t,t,t,t,t,t,t,t,t,t,t,t,t,t,t
                      	
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f;d
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	; db f,f,f,f,f,f,f,f,f,f,f,f,f,f,f
                      	
  16E7  80000000000080	 db t,f,f,f,f,f,t,f,t,t,f,f,f,f,t
  16F6  00800000808000	 db f,t,f,f,t,t,f,t,f,f,f,t,f,t,f
  1705  80800080800000	 db t,t,f,t,t,f,f,t,t,t,t,f,t,t,f
  1714  80800000008080	 db t,t,f,f,f,t,t,t,f,f,t,t,f,t,f
  1723  80000000800080	 db t,f,f,f,t,f,t,f,t,t,t,t,t,f,t
  1732  00008000000000	 db f,f,t,f,f,f,f,f,f,t,f,f,t,f,f
  1741  00800080008080	 db f,t,f,t,f,t,t,f,f,f,f,f,t,f,f
                      	 
  1750                	 ds 201*59
                      	 
  45A3                	hp_table1:
  45A3  01010101010101	 db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
  45B3                	hp_table2:
  45B3  01010101181818	 db 1,1,1,1,24,24,24,1,1
  45BC                	hp_table3:
  45BC  18303060609060	 db 24,48,48,96,96,144,96
  45C3                	hp_table4:
  45C3  3050700160    	 db 48,80,112,1,96
  45C8                	hp_table5:
  45C8  01010101010101	 db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,10110000b
                      	 
                      	;**********************************Variable**************************************
  45D8  00            	floor:db 0
  45D9  0000          	pdoor_xy:dw 0		;83h
  45DB  0000          	pkey_xy:dw 0		;85h
  45DD  0000          	pgil_xy:dw 0		;84h,8fh
  45DF                	obj:ds 48
  460F                	obj_hp:ds 48
  463F                	obj_wp:ds 48
  466F                	obj_st:ds 48
  469F                	obj_xy:ds 96;(x,y&d)
  46FF                	obj_st2:ds 48
  472F                	obj_st3:ds 48
                      	
  475F  00            	gil_button:db 0
  4760  00            	gil_hp:db 0
  4761  00            	gil_wp:db 0
  4762  00            	gil_st1:db 0	;00 or ffh:right foot or left foot
  4763  00            	gil_st2:db 0	;bit 0-6:counter,bit 7:sword set,if bit 7 enable and bit 0-6 > 0 dec (st2)
                      			;
  4764  00            	gil_matk:db 0	;1:c,2:s,3:g,0:none
  4765  FF            	gil_matk_count:db 255	;matk use count.it is deced when use a matk.
  4766  00            	gil_bt:db 0	;1 is dash enable.
  4767  00            	gil_sword:db 0	;1:dragon,2:ex
  4768  00            	gil_armor:db 0	;1 is hyper.
  4769  00            	gil_gunt:db 0	;1 is hyper.
  476A  00            	gil_shield:db 0	;1 is hyper.
  476B  00            	gil_neck:db 0	;1:g,2:r,3:b.
                      	
  476C                	gil_xy:ds 2
  476E                	gil_dblock:ds 2
  4770                	end
